V(function(){var $t=$T.domain('importer');var ImporterUtils={resourcesExtensionList:{'pdf':1,'doc':1,'docx':1,'ppt':1},reportNumberSystems:{"invenio":"cds","dummy":"Dummy"},shortMonthsNames:[$t.gettext("Jan"),$t.gettext("Feb"),$t.gettext("Mar"),$t.gettext("Apr"),$t.gettext("May"),$t.gettext("Jun"),$t.gettext("Jul"),$t.gettext("Aug"),$t.gettext("Sep"),$t.gettext("Oct"),$t.gettext("Nov"),$t.gettext("Dec")],minutesToTime:function(minutes){if(minutes<=1440){return((minutes-minutes%60)/60<10?"0"+(minutes-minutes%60)/60:(minutes-minutes%60)/60)\u000a+":"+(minutes%60<10?"0"+minutes%60:minutes%60);}else{return'00:00';}},compareStartTime:function(a,b){return a.startDate.time>b.startDate.time;},sortedKeys:function(dict,sortFunc){var array=[];each(dict,function(item){array.push(item);});return array.sort(sortFunc);},isPersonEmpty:function(person){return!person||(!person.firstName&&!person.familyName);},_sendRequest:function(url,args,onSuccess,onError){$.ajax({async:false,url:url,method:'POST',data:args,success:function(data,textStatus){if($.isFunction(onSuccess)){onSuccess(data,textStatus);}},error:function(xhr){if($.isFunction(onError)){onError({title:$t.gettext('Something went wrong'),message:'{0} ({1})'.format(xhr.statusText.toLowerCase(),xhr.status),suggest_login:false,report_url:null});}}});}};type("QueueDict",[],{set:function(key,value){var existed=false;for(var i in this.keySequence){if(key==this.keySequence[i]){existed=true;if(value!==null){this.keySequence[i]=value;}else{this.keySequence.splice(i,1);}}}\u000aif(!existed){this.keySequence.push(key);}\u000athis.dict[key]=value;},getKeys:function(){return this.keySequence;},get:function(key){return this.dict[key];},getValues:function(){var tmp=[];for(var index in this.keySequence){tmp.push(this.get(this.keySequence[index]));}\u000areturn tmp;},getLength:function(){return this.keySequence.length;},clear:function(){this.keySequence=[];this.dict={};},shiftTop:function(idx){if(idx>0){var tmp=this.keySequence[idx];this.keySequence[idx]=this.keySequence[idx-1];this.keySequence[idx-1]=tmp;}},shiftBottom:function(idx){if(idx<this.keySequence.length-1){var tmp=this.keySequence[idx];this.keySequence[idx]=this.keySequence[idx+1];this.keySequence[idx+1]=tmp;}}},function(){this.keySequence=[];this.dict={};});type("ImportDialog",["ExclusivePopupWithButtons","PreLoadHandler"],{_preload:[function(hook){var self=this;$.ajax({url:build_url(ImporterPlugin.urls.importers,{}),type:'GET',dataType:'json',success:function(data){if(handleAjaxError(data)){return;}\u000aself.importers=data;hook.set(true);}});}],_hideLists:function(){this.importerList.hide();this.timetableList.hide();this.emptySearchDiv.show();},_showLists:function(){this.importerList.show();this.timetableList.refresh();this.timetableList.show();this.emptySearchDiv.hide();},drawContent:function(){var self=this;var search=function(){self.importerList.search(query.dom.value,importFrom.dom.value,20,[function(){self._showLists();}]);};var searchButton=Html.input('button',{},$t.gettext('search'));searchButton.observeClick(search);var importFrom=Html.select({});for(var importer in this.importers)\u000aimportFrom.append(Html.option({value:importer},this.importers[importer]));var query=Html.input('text',{});query.observeEvent('keypress',function(event){if(event.keyCode==13){search();}});this.emptySearchDiv=new PresearchContainer(this.height,function(){self._showLists();});var _observeInsertButton=function(){if(self.importerList.getSelectedList().getLength()>0&&self.timetableList.getSelection()){self.insertButton.disabledButtonWithTooltip('enable');}else{self.insertButton.disabledButtonWithTooltip('disable');}};this.importerList=new ImporterList([],{"height":this.height-80,"width":this.width/2-20,"cssFloat":"left"},'entryList','entryListSelected',true,_observeInsertButton);this.timetableList=new TableTreeList(this.topTimetable,{"height":this.height-80,"width":this.width/2-20,"cssFloat":"right"},'treeList','treeListDayName','treeListEntry',true,_observeInsertButton);return Html.div({},Html.div({className:'importDialogHeader',style:{width:pixels(this.width*0.9)}},query,searchButton,' ',$t.gettext("in"),' ',importFrom),this.emptySearchDiv.draw(),this.importerList.draw(),this.timetableList.draw());},_getButtons:function(){var self=this;return[[$t.gettext('Proceed...'),function(){var destination=self.timetableList.getSelection();var entries=self.importerList.getSelectedList();var importer=self.importerList.getLastImporter();new ImporterDurationDialog(entries,destination,self.confId,self.timetable,importer,function(redirect){if(!redirect){self._hideLists();self.timetableList.clearSelection();self.importerList.clearSelection();self.emptySearchDiv.showAfterSearch();}\u000aself.reloadPage=true;});}],[$t.gettext('Close'),function(){self.close();}]];},draw:function(){this.insertButton=this.buttons.eq(0);this.insertButton.disabledButtonWithTooltip({tooltip:$t.gettext('Please select contributions to be added and their destination.'),disabled:true});return this.ExclusivePopupWithButtons.prototype.draw.call(this,this.drawContent());},_onClose:function(evt){if(this.reloadPage){location.reload();IndicoUI.Dialogs.Util.progress();}\u000areturn self.ExclusivePopupWithButtons.prototype._onClose.call(this,evt);}},function(timetable){var self=this;this.ExclusivePopupWithButtons($t.gettext("Import Entries"));this.timetable=timetable?timetable:window.timetable;this.topTimetable=this.timetable.parentTimetable?this.timetable.parentTimetable:this.timetable;this.confId=this.topTimetable.contextInfo.id;this.height=document.body.clientHeight-200;this.width=document.body.clientWidth-200;this.PreLoadHandler(this._preload,function(){self.open();});this.execute();});type("PresearchContainer",[],{show:function(){this.contentDiv.dom.style.display='block';},hide:function(){this.contentDiv.dom.style.display='none';},showAfterSearch:function(){this.firstSearch.dom.style.display='none';this.afterSearch.dom.style.display='inline';},draw:function(){this.firstSearch=Html.span({style:{display:"inline"}},$t.gettext("Please type your search phrase and press 'search'."));var hereLink=Html.span({className:'fake-link'},$t.gettext("here"));hereLink.observeClick(this.afterSearchAction);this.afterSearch=Html.span({style:{display:'none'}},$t.gettext("Your entries were inserted successfully. Please specify a new query or click"),' ',hereLink,' ',$t.gettext("to see the previous results."));this.contentDiv=Html.div({className:'presearchContainer',style:{"height":pixels(this.height-130)}},this.firstSearch,this.afterSearch);return this.contentDiv;}},function(height,afterSearchAction){this.height=height;this.afterSearchAction=afterSearchAction;});type("ImporterDurationDialog",["ExclusivePopupWithButtons","PreLoadHandler"],{_preload:[function(hook){var self=this;if(this.destination.entryType=='Contribution'){self.info.set("startTime",this.destination.startDate.time.substr(0,5));hook.set(true);}else{var url;if(this.destination.entryType=='Day'){url=build_url(ImporterPlugin.urls.day_end_date,{importer_name:'indico_importer',confId:this.confId});}\u000aif(this.destination.entryType=='Session'){url=build_url(ImporterPlugin.urls.block_end_date,{importer_name:'indico_importer',confId:this.confId,entry_id:this.destination.scheduleEntryId});}\u000a$.ajax({url:url,data:{sessionId:this.destination.sessionId,slotId:this.destination.sessionSlotId,selectedDay:this.destination.startDate.date.replace(/-/g,'/')},success:function(data){self.info.set('startTime',data);hook.set(true);}});}}],drawContent:function(){var durationField=Html.input('text',{},this.destination.contribDuration?this.destination.contribDuration:20);var timeField=Html.input('text',{});var redirectCheckbox=Html.input('checkbox',{});this.parameterManager.add(durationField,'unsigned_int',false);this.parameterManager.add(timeField,'time',false);$B(this.info.accessor("duration"),durationField);$B(timeField,this.info.accessor("startTime"));$B(this.info.accessor("redirect"),redirectCheckbox);return IndicoUtil.createFormFromMap([[$t.gettext("Duration time of every inserted contribution:"),durationField],[$t.gettext("Start time of the first contribution:"),timeField],[$t.gettext("Show me the destination:"),redirectCheckbox]]);},_performRedirect:function(){var fragment=this.destination.startDate.date.replace(/-/g,'');if(this.destination.entryType=='Session'){fragment+='.'+this.destination.id;}\u000alocation.hash=fragment;location.reload();},_getUrl:function(eventId,day,destination){var params={'confId':eventId};if(destination.entryType=='Day'){params.day=day;return build_url(ImporterPlugin.urls.add_contrib,params);}\u000aif(destination.entryType=='Session'){params.day=day;params.session_block_id=destination.sessionSlotId;return build_url(ImporterPlugin.urls.add_contrib,params);}\u000aif(destination.entryType=='Contribution'){params.contrib_id=destination.contributionId;return build_url(ImporterPlugin.urls.create_subcontrib_rest,params);}},_personLinkData:function(entry){var authorType={'none':0,'primary':1,'secondary':2};var linkDataEntry=function(author,authorType,speaker){if(speaker===undefined){speaker=!!author.isSpeaker;}\u000areturn $.extend({'authorType':authorType,'isSpeaker':speaker,'isSubmitter':false},author);};var linkData=[];if(!ImporterUtils.isPersonEmpty(entry.primaryAuthor)){linkData.push(linkDataEntry(entry.primaryAuthor,authorType.primary));}\u000aif(!ImporterUtils.isPersonEmpty(entry.secondaryAuthor)){linkData.push(linkDataEntry(entry.secondaryAuthor,authorType.secondary));}\u000aif(!ImporterUtils.isPersonEmpty(entry.speaker)){linkData.push(linkDataEntry(entry.speaker,authorType.none,true));}\u000aif(!this.timetable.eventInfo.isConference){var speakersLinkData=[];$.each(linkData,function(){if(this.isSpeaker){this.authorType=authorType.none;speakersLinkData.push(this);}});return speakersLinkData;}\u000areturn linkData;},_addContributionMaterial:function(title,link_url,eventId,contributionId,subContributionId){var requestUrl;if(subContributionId!==undefined){requestUrl=build_url(ImporterPlugin.urls.add_link,{'confId':eventId,'contrib_id':contributionId,'subcontrib_id':subContributionId,'object_type':'subcontribution'});}else{requestUrl=build_url(ImporterPlugin.urls.add_link,{'confId':eventId,'contrib_id':contributionId,'object_type':'contribution'});}\u000avar params={'csrf_token':$('#csrf-token').attr('content'),'link_url':link_url,'title':title,'folder':'__None','acl':'[]'};ImporterUtils._sendRequest(requestUrl,params);},_addReference:function(type,value,eventId,contributionId,subContributionId){var url;if(subContributionId!==undefined){url=build_url(ImporterPlugin.urls.create_subcontrib_reference_rest,{'confId':eventId,'contrib_id':contributionId,'subcontrib_id':subContributionId});}else{url=build_url(ImporterPlugin.urls.create_contrib_reference_rest,{'confId':eventId,'contrib_id':contributionId});}\u000avar params={'csrf_token':$('#csrf-token').attr('content'),'type':type,'value':value};ImporterUtils._sendRequest(url,params);},_getButtons:function(){var self=this;return[[$t.gettext('Insert'),function(){if(!self.parameterManager.check()){return;}\u000avar time=parseFloat(self.info.get('startTime').split(':')[0])*60+parseFloat(self.info.get('startTime').split(':')[1]);var duration=parseInt(self.info.get('duration'));if(time+duration*self.entries.getLength()<=1440){var hasError=false;var killProgress=IndicoUI.Dialogs.Util.progress();var errorCallback=function(error){if(error){hasError=true;showErrorDialog(error);}};var date=self.destination.startDate.date.replace(/-/g,'/');var args=[];each(self.entries.getValues(),function(entry){entry=entry.getAll();var timeStr=ImporterUtils.minutesToTime(time);var params={'csrf_token':$('#csrf-token').attr('content'),'title':entry.title?entry.title:"Untitled",'description':entry.summary,'duration':[duration,'minutes'],'references':'[]'};if(self.destination.entryType=='Contribution'){$.extend(params,{'speakers':Json.write(self._personLinkData(entry))});}else{$.extend(params,{'time':timeStr,'person_link_data':Json.write(self._personLinkData(entry)),'location_data':'{"address": "", "inheriting": true}','type':'__None'});}\u000avar url=self._getUrl(self.confId,date,self.destination);var successCallback=function(result){var materials=entry.materials||{};var reportNumbers=entry.reportNumbers||[];var reportNumbersLabel=ImporterUtils.reportNumberSystems[self.importer];if(self.destination.entryType=='Contribution'){$.each(materials,function(title,url){self._addContributionMaterial(title,url,result.event_id,result.contribution_id,result.id);});$.each(reportNumbers,function(idx,number){self._addReference(reportNumbersLabel,number,self.confId,result.contribution_id,result.id);});}else{var contribution=result.entries[0].entry;$.each(materials,function(title,url){self._addContributionMaterial(title,url,self.confId,contribution.contributionId);});$.each(reportNumbers,function(idx,number){self._addReference(reportNumbersLabel,number,self.confId,contribution.contributionId);});}};ImporterUtils._sendRequest(url,params,successCallback,errorCallback);time+=duration;});if(self.successFunction){self.successFunction(self.info.get('redirect'));}\u000aif(self.info.get('redirect')){self._performRedirect();}\u000aself.close();killProgress();}\u000aelse{new WarningPopup("Warning","Some contributions will end after 24:00. Please modify start time and duration.").open();}}],[$t.gettext('Cancel'),function(){self.close();}]];},draw:function(){return this.ExclusivePopupWithButtons.prototype.draw.call(this,this.drawContent());}},function(entries,destination,confId,timetable,importer,successFunction){var self=this;this.ExclusivePopupWithButtons($t.gettext('Adjust entries'));this.confId=confId;this.entries=entries;this.destination=destination;this.timetable=timetable;this.successFunction=successFunction;this.importer=importer;this.parameterManager=new IndicoUtil.parameterManager();this.info=new WatchObject();this.PreLoadHandler(this._preload,function(){self.open();});this.execute();});type("ImporterListWidget",["SelectableListWidget"],{clearList:function(){this.SelectableListWidget.prototype.clearList.call(this);this.recordDivs=[];},clearSelection:function(){this.SelectableListWidget.prototype.clearSelection.call(this);this.selectedObserver(this.selectedList);},getLength:function(){return this.recordDivs.length;},getLastQuery:function(){return this.lastSearchQuery;},getLastImporter:function(){return this.lastSearchImporter;},isMoreToImport:function(){return this.moreToImport;},_searchBase:function(query,importer,size,successFunc,callbacks){var self=this;$.ajax({url:build_url(ImporterPlugin.urls.import_data,{'importer_name':importer,'query':query,'size':size+1}),type:'POST',dataType:'json',complete:IndicoUI.Dialogs.Util.progress(),success:function(data){if(handleAjaxError(data)){return;}\u000asuccessFunc(data.records);_.each(callbacks,function(callback){callback();});}});this.lastSearchImporter=importer;this.lastSearchQuery=query;this.lastSearchSize=size;},search:function(query,importer,size,callbacks){var self=this;var successFunc=function(result){self.clearList();var importedRecords=0;self.moreToImport=false;for(var record in result){if(size==importedRecords++){self.moreToImport=true;break;}\u000aself.set(record,$O(result[record]));}};this._searchBase(query,importer,size,successFunc,callbacks);},append:function(size,callbacks){var self=this;var lastLength=this.getLength();var successFunc=function(result){var importedRecords=0;self.moreToImport=false;for(var record in result){if(lastLength+size==importedRecords){self.moreToImport=true;break;}\u000aif(lastLength-1<importedRecords){self.set(record,$O(result[record]));}\u000a++importedRecords;}};this._searchBase(this.getLastQuery(),this.getLastImporter(),this.getLength()+size,successFunc,callbacks);},_getPersonString:function(person){return person.firstName+" "+person.familyName+\u000a(person.affiliation?" ("+person.affiliation+")":"");},_drawSelectionIndex:function(){var self=this;var selectionIndex=Html.div({className:'entryListIndex',style:{display:'none',cssFloat:'left'}});var stopMouseEvent=function(event){event.cancelBubble=true;if(event.preventDefault){event.preventDefault();}else{event.returnValue=false;}\u000areturn false;};selectionIndex.observeEvent('contextmenu',stopMouseEvent);selectionIndex.observeEvent('mousedown',stopMouseEvent);selectionIndex.observeEvent('click',stopMouseEvent);selectionIndex.observeEvent('mouseup',function(event){event.cancelBubble=true;if(event.which===null){var button=event.button==1?"left":"notLeft";}else{var button=event.which==1?"left":"notLeft";}\u000avar idx=parseInt(selectionIndex.dom.innerHTML.substr(0,selectionIndex.dom.innerHTML.length-2)-1);if(button=="left"){self.selectedList.shiftTop(idx);}else{self.selectedList.shiftBottom(idx);}\u000aself.observeSelection(self.selectedList);});return selectionIndex;},_convertMaterials:function(materials){var materialsDict={};each(materials,function(mat){var key=mat.name||'';if(!materialsDict[key]){materialsDict[key]=[];}\u000amaterialsDict[key].push(mat.url);});return materialsDict;},_getResourceName:function(resource){var splittedName=resource.split('.');if(splittedName[splittedName.length-1]in ImporterUtils.resourcesExtensionList){return splittedName[splittedName.length-1];}else{return'resource';}},_drawItem:function(record){var self=this;var recordDiv=Html.div({});var key=record.key;record=record.get();if(record.get("reportNumbers")){var reportNumber=Html.div({},Html.em({},$t.gettext("Report number(s)")),":");each(record.get("reportNumbers"),function(id){reportNumber.append(" "+id);});recordDiv.append(reportNumber);}\u000aif(record.get("title")){recordDiv.append(Html.div({},Html.em({},$t.gettext("Title")),": ",record.get("title")));}\u000aif(record.get("meetingName")){recordDiv.append(Html.div({},Html.em({},$t.gettext("Meeting")),": ",record.get("meetingName")));}\u000aif(!ImporterUtils.isPersonEmpty(record.get('primaryAuthor'))){recordDiv.append(Html.div({},Html.em({},$t.gettext("Primary author")),": ",this._getPersonString(record.get("primaryAuthor"))));}\u000aif(!ImporterUtils.isPersonEmpty(record.get('secondaryAuthor'))){recordDiv.append(Html.div({},Html.em({},$t.gettext("Secondary author")),": ",this._getPersonString(record.get("secondaryAuthor"))));}\u000aif(!ImporterUtils.isPersonEmpty(record.get('speaker'))){recordDiv.append(Html.div({},Html.em({},$t.gettext("Speaker")),": ",this._getPersonString(record.get("speaker"))));}\u000aif(record.get("summary")){var summary=record.get("summary");if(summary.length<200){recordDiv.append(Html.div({},Html.em({},$t.gettext("Summary")),": ",summary));}else{var summaryBeg=Html.span({},summary.substr(0,200));var summaryEnd=Html.span({style:{display:'none'}},summary.substr(200));var showLink=Html.span({className:'fake-link'},$t.gettext(" (show all)"));showLink.observeClick(function(evt){summaryEnd.dom.style.display="inline";showLink.dom.style.display="none";hideLink.dom.style.display="inline";evt.cancelBubble=true;self.observeSelection(self.selectedList);});var hideLink=Html.span({className:'fake-link',style:{display:'none'}},$t.gettext(" (hide)"));hideLink.observeClick(function(evt){summaryEnd.dom.style.display="none";showLink.dom.style.display="inline";hideLink.dom.style.display="none";evt.cancelBubble=true;self.observeSelection(self.selectedList);});var sumamaryDiv=Html.div({},Html.em({},$t.gettext("Summary")),": ",summaryBeg,showLink,summaryEnd,hideLink);recordDiv.append(sumamaryDiv);}}\u000aif(record.get("place")){recordDiv.append(Html.div({},Html.em({},$t.gettext("Place")),": ",record.get("place")));}\u000aif(record.get("materials")){record.set("materials",this._convertMaterials(record.get("materials")));var materials=Html.div({},Html.em({},$t.gettext("Materials")),":");for(var mat in record.get("materials")){var materialType=Html.div({},mat?(mat+":"):'');each(record.get("materials")[mat],function(resource){var link=Html.a({href:resource,target:"_new"},self._getResourceName(resource));link.observeClick(function(evt){evt.cancelBubble=true;});materialType.append(" ");materialType.append(link);});materials.append(materialType);}\u000arecordDiv.append(materials);}\u000arecordDiv.append(this._drawSelectionIndex());this.recordDivs[key]=recordDiv;return recordDiv;},observeSelection:function(list){var self=this;for(var entry in this.recordDivs){var record=this.recordDivs[entry];record.dom.lastChild.style.display='none';record.dom.lastChild.innerHTML='';}\u000avar seq=1;each(list.getKeys(),function(entry){var record=self.recordDivs[entry];record.dom.lastChild.style.display='block';record.dom.lastChild.style.top=pixels(-(record.dom.clientHeight+23)/2);record.dom.lastChild.innerHTML=seq;switch(seq){case 1:record.dom.lastChild.innerHTML+=$t.gettext('st');break;case 2:record.dom.lastChild.innerHTML+=$t.gettext('nd');break;case 3:record.dom.lastChild.innerHTML+=$t.gettext('rd');break;default:record.dom.lastChild.innerHTML+=$t.gettext('th');break;}\u000a++seq;});}},function(events,listStyle,selectedStyle,customObserver){var self=this;var observer=function(list){this.observeSelection(list);if(customObserver){customObserver(list);}};this.SelectableListWidget(observer,false,listStyle,selectedStyle);this.selectedList=new QueueDict();this.recordDivs={};for(var record in events){this.set(record,$O(events[record]));}});type("ImporterList",[],{show:function(){this.contentDiv.dom.style.display='block';},hide:function(){this.contentDiv.dom.style.display='none';},getSelectedList:function(){return this.importerWidget.getSelectedList();},clearSelection:function(){this.importerWidget.clearSelection();},getLastImporter:function(){return this.importerWidget.getLastImporter();},handleContent:function(){if(this.descriptionDiv&&this.emptyDescriptionDiv){if(this.importerWidget.getLength()===0){this.descriptionDiv.dom.style.display='none';this.emptyDescriptionDiv.dom.style.display='block';this.moreEntriesDiv.dom.style.display='none';}else{this.entriesCount.dom.innerHTML=$t.ngettext("One entry was found. ","{0} entries were found. ",this.importerWidget.getLength()).format(this.importerWidget.getLength());this.descriptionDiv.dom.style.display='block';this.emptyDescriptionDiv.dom.style.display='none';if(this.importerWidget.isMoreToImport()){this.moreEntriesDiv.dom.style.display='block';}else{this.moreEntriesDiv.dom.style.display='none';}}}},_appendCallbacks:function(callbacks){var self=this;if(callbacks){callbacks.push(function(){self.handleContent();});}else{callbacks=[function(){self.handleContent();}];}\u000areturn callbacks;},search:function(query,importer,size,callbacks){this.importerWidget.search(query,importer,size,this._appendCallbacks(callbacks));},append:function(size,callbacks){this.importerWidget.append(size,this._appendCallbacks(callbacks));},draw:function(){var importerDiv=this._drawImporterDiv();this.contentDiv=Html.div({className:'entryListContainer'},this._drawHeader(),importerDiv);for(var style in this.style){this.contentDiv.setStyle(style,this.style[style]);if(style=='height'){importerDiv.setStyle('height',this.style[style]-76);}}\u000aif(this.hidden){this.contentDiv.dom.style.display='none';}\u000areturn this.contentDiv;},_drawHeader:function(){this.entriesCount=Html.span({},'0');this.descriptionDiv=Html.div({className:'entryListDesctiption'},this.entriesCount,$t.gettext("Please select the results you want to insert."));this.emptyDescriptionDiv=Html.div({className:'entryListDesctiption'},$t.gettext("No results were found. Please change the search phrase."));return Html.div({},Html.div({className:'entryListHeader'},$t.gettext("Step 1: Search results:")),this.descriptionDiv,this.emptyDescriptionDiv);},_drawImporterDiv:function(){var self=this;this.moreEntriesDiv=Html.div({className:'fake-link',style:{paddingBottom:pixels(15),textAlign:'center',clear:'both',marginTop:pixels(15)}},$t.gettext("more results"));this.moreEntriesDiv.observeClick(function(){self.append(20);});return Html.div({style:{overflow:'auto'}},this.importerWidget.draw(),this.moreEntriesDiv);}},function(events,style,listStyle,selectedStyle,hidden,observer){this.importerWidget=new ImporterListWidget(events,listStyle,selectedStyle,observer);this.style=style;this.hidden=hidden;});type("TimetableListWidget",["ListWidget"],{setSelection:function(selected,div){if(this.selectedDiv){this.selectedDiv.dom.style.fontWeight="normal";this.selectedDiv.dom.style.boxShadow="";this.selectedDiv.dom.style.MozBoxShadow="";}\u000aif(this.selected!=selected){this.selectedDiv=div;this.selected=selected;this.selectedDiv.dom.style.fontWeight="bold";this.selectedDiv.dom.style.boxShadow="3px 3px 15px #000000";this.selectedDiv.dom.style.MozBoxShadow="3px 3px 15px #000000";}else{this.selected=null;this.selectedDiv=null;}\u000aif(this.observeSelection){this.observeSelection();}},clearSelection:function(){if(this.selectedDiv){this.selectedDiv.dom.style.backgroundColor="";}\u000athis.selected=null;this.selectedDiv=null;if(this.observeSelection){this.observeSelection();}},getSelection:function(){return this.selected;},_drawItem:function(item,level){var self=this;level=level?level:0;switch(item.entryType){case'Contribution':item.color="#F8F2E8";item.textColor="#000000";case'Session':var titleDiv=Html.div({className:"treeListEntry",style:{backgroundColor:item.color,color:item.textColor}},item.title+(item.startDate&&item.endDate?" ("+item.startDate.time.substr(0,5)+" - "+item.endDate.time.substr(0,5)+")":""));var entries=ImporterUtils.sortedKeys(item.entries,ImporterUtils.compareStartTime);break;case'Break':if(this.displayBreaks){var titleDiv=Html.div({className:"treeListEntry",style:{backgroundColor:item.color,color:item.textColor}},item.title+(item.startDate&&item.endDate?" ("+item.startDate.time.substr(0,5)+" - "+item.endDate.time.substr(0,5)+")":""));var entries=ImporterUtils.sortedKeys(item.entries,ImporterUtils.compareStartTime);}else{return null;}\u000abreak;case undefined:item.entryType='Day';item.startDate={date:item.key.substr(0,4)+"-"+item.key.substr(4,2)+"-"+item.key.substr(6,2)};item.color="#FFFFFF";item.textColor="#000000";var titleDiv=Html.div({className:"treeListDayName"},item.key.substr(6,2)+" "+ImporterUtils.shortMonthsNames[parseFloat(item.key.substr(4,2))-1]+" "+item.key.substr(0,4));var entries=ImporterUtils.sortedKeys(item.get().getAll(),ImporterUtils.compareStartTime);break;}\u000atitleDiv.observeClick(function(){self.setSelection(item,titleDiv);});var itemDiv=Html.div({style:{marginLeft:pixels(level*20),clear:"both",padding:pixels(5)}},titleDiv);var entriesDiv=Html.div({style:{display:"none"}});for(var entry in entries){entriesDiv.append(this._drawItem(entries[entry],level+1));}\u000aif(entries.length){titleDiv.append(this._drawShowHideButtons(entriesDiv));itemDiv.append(entriesDiv);}\u000areturn itemDiv;},_drawShowHideButtons:function(div){var showButton=Html.img({src:imageSrc("collapsd"),style:{display:'block'}});var hideButton=Html.img({src:imageSrc("exploded"),style:{display:'none'}});showButton.observeClick(function(evt){div.dom.style.display="block";showButton.dom.style.display="none";hideButton.dom.style.display="block";evt.cancelBubble=true;});hideButton.observeClick(function(evt){div.dom.style.display="none";showButton.dom.style.display="block";hideButton.dom.style.display="none";evt.cancelBubble=true;});return Html.div({className:'expandButtonsDiv'},showButton,hideButton);},_insertFromTimetable:function(){var self=this;var timetableData=this.timetable.getData();each(this.timetable.sortedKeys,function(day){self.set(day,$O(timetableData[day]));});},refresh:function(){this.clear();this._insertFromTimetable();}},function(timetable,listStyle,dayStyle,eventStyle,observeSelection,displayBreaks){this.timetable=timetable;this.displayBreaks=displayBreaks;this.observeSelection=observeSelection;var self=this;this.ListWidget(listStyle);this._insertFromTimetable();});type("TableTreeList",[],{show:function(){this.contentDiv.dom.style.display='block';},hide:function(){this.contentDiv.dom.style.display='none';},getSelection:function(){return this.timetableList.getSelection();},clearSelection:function(){return this.timetableList.clearSelection();},setSelection:function(selected,div){return this.timetableList.setSelection(selected,div);},refresh:function(){this.timetableList.refresh();},draw:function(){this.contentDiv=Html.div({className:'treeListContainer'},Html.div({className:'treeListHeader'},$t.gettext("Step 2: Choose destination:")),Html.div({className:'treeListDescription'},$t.gettext("Please select the place in which the contributions will be inserted.")));var treeDiv=Html.div({style:{overflow:'auto'}},this.timetableList.draw());for(var style in this.style){this.contentDiv.setStyle(style,this.style[style]);if(style=='height'){treeDiv.setStyle('height',this.style[style]-76);}}\u000athis.contentDiv.append(treeDiv);if(this.hidden){this.contentDiv.dom.style.display='none';}\u000areturn this.contentDiv;}},function(timetable,style,listStyle,dayStyle,eventStyle,hidden,observer){this.timetableList=new TimetableListWidget(timetable,listStyle,dayStyle,eventStyle,observer);this.style=style;this.hidden=hidden;});$(function(){$('#timetable').on('click','.js-create-importer-dialog',function(){var timetable=$(this).data('timetable');new ImportDialog(timetable);});});})();
p1
.