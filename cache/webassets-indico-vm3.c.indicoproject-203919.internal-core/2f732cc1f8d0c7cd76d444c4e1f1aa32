V(function(global){'use strict';global.setupAbstractList=function setupAbstractList(){var abstractListContainer=$('#abstract-list');var filterConfig={itemHandle:'tr',listItems:'#abstract-list tbody tr',term:'#search-input',state:'#filtering-state',placeholder:'#filter-placeholder'};var applySearchFilters=setupListGenerator(filterConfig);abstractListContainer.on('indico:htmlUpdated',function(){abstractListContainer.find('.js-mathjax').mathJax();_.defer(applySearchFilters);});};global.setupAbstractEmailTemplatesPage=function setupAbstractEmailTemplatesPage(){$('.js-edit-tpl-dropdown').parent().dropdown();$('.email-templates > ul').sortable({axis:'y',containment:'parent',cursor:'move',distance:2,handle:'.ui-i-box-sortable-handle',items:'> li',tolerance:'pointer',forcePlaceholderSize:true,placeholder:'regform-section-sortable-placeholder',update:function(){var $elem=$('.email-templates > ul');var sortedList=$elem.find('li.email-template').map(function(i,elem){return $(elem).data('id');}).get();$.ajax({url:$elem.data('url'),method:'POST',contentType:'application/json',data:JSON.stringify({sort_order:sortedList}),complete:IndicoUI.Dialogs.Util.progress(),error:handleAjaxError});}});$('.email-preview-btn').on('click',function(evt){evt.preventDefault();var id=$(this).data('id');var $previewBtn=$('#email-preview-btn-'+id);if($previewBtn.data('visible')){$previewBtn.text($T.gettext('Show preview'));$('#email-preview-'+id).slideToggle();$previewBtn.data('visible',false);}else{$previewBtn.text($T.gettext('Hide preview'));$('#email-preview-'+id).slideToggle();$previewBtn.data('visible',true);}});$('#email-template-manager .ui-i-box-sortable-handle').on('mousedown',function(){$('.email-preview').hide();$('.email-preview-btn').text($T.gettext('Show preview')).data('visible',false);});$('.js-toggle-stop-on-match').on('click',function(evt){evt.preventDefault();var $this=$(this);var stopOnMatch=!$this.data('stop-on-match');if($this.hasClass('disabled')){return;}\u000a$.ajax({url:$this.data('href'),method:$this.data('method'),data:JSON.stringify({stop_on_match:stopOnMatch}),dataType:'json',contentType:'application/json',error:handleAjaxError,success:function(){$this.data('stop-on-match',stopOnMatch);$this.toggleClass('stop-processing-enabled',stopOnMatch);}});});};global.setupCallForAbstractsPage=function setupCallForAbstractsPage(options){options=$.extend({hasAbstracts:false},options);if(location.hash==='#submit-abstract'){$(document).ready(function(){$('.js-show-abstract-form').trigger('click');});}\u000aif(options.hasAbstracts){var filterConfig={itemHandle:'div.contribution-row',listItems:'#display-contribution-list div.contribution-row',term:'#search-input',state:'#filtering-state',placeholder:'#filter-placeholder'};var applySearchFilters=setupSearchBox(filterConfig);applySearchFilters();}};})(window);(function($){'use strict';function _listValue(option){if(option===''){return[];}else{var parsedValue=parseInt(option,10);return[isNaN(parsedValue)?option:parsedValue];}}\u000afunction _optionValue(option){if(option.length===0){return'';}else{return option[0];}}\u000afunction _findConditionByName(ruleContext,conditionName){return ruleContext.$element.find('.rule-condition').filter(function(){return $(this).attr('data-condition')===conditionName;});}\u000a$.widget('indico.rulelistwidget',{options:{containerElement:null,conditionChoices:{},conditionTypes:[]},_renderRuleCondition:function(ruleContext,condition){var self=this;var $select=$('<select>').append(_.map(condition.options,function(elem){var optionTitle=elem[1];var id=elem[0];return $('<option>',{value:id}).text(optionTitle);})).on('change',function(){self._optionSelected(ruleContext,condition,$(this).val());self.element.trigger('change');});if(condition.required){var $opt=$('<option>',{value:'',text:$T.gettext('Select an option')});$select.prepend($opt).val('');$opt.prop('disabled',true);}\u000avar $html=$('<div>',{class:'rule-condition'}).attr('data-condition',condition.value);if(condition.labelText){$html.append($('<label>').text(condition.labelText));}\u000areturn $html.append($select);},_optionSelected:function(ruleContext,condition,newOption){ruleContext.rule[condition.value]=_listValue(newOption);this._checkConditionIncompatibility(ruleContext);this.element.trigger('change');},_onChange:function(){this.ruleData.forEach(function(rule){_.keys(rule).forEach(function(k){if(_.isEqual(rule[k],['*'])){delete rule[k];}});});this.element.val(JSON.stringify(this.ruleData));},_checkConditionIncompatibility:function(ruleContext){ruleContext.$element.find('.rule-condition').show();this.conditionSpec.forEach(function(condition){var $condition=_findConditionByName(ruleContext,condition.value);var newOption=$condition.find('select').val();if(condition.compatibleWith){var compatibleConditions=condition.compatibleWith[newOption];ruleContext.$element.find('.rule-condition').each(function(){var $this=$(this);var conditionName=$this.data('condition');if(this===$condition.get(0)){return;}\u000aif(_.contains(compatibleConditions,conditionName)){$this.show();}else{$this.hide();delete ruleContext.rule[conditionName];}});}});},_setConditionOption:function(ruleContext,conditionName,value){var $condition=_findConditionByName(ruleContext,conditionName);var $select=$condition.find('select');var isRequired=this.options.conditionChoices[conditionName].required;if(!isRequired&&value===undefined){value=this.options.conditionChoices[conditionName].options[0][0];}\u000aif(value!==undefined){$select.val(_optionValue(value));}},_checkPlaceholder:function(){var $placeholder=this.options.containerElement.find('.no-rules-placeholder');$placeholder.toggle(!this.ruleData.length);},_addRule:function($ruleList,rule){var self=this;var ruleContext={$element:$('<li>',{class:'rule'}),rule:rule};var $removeButton=$('<a>',{class:'i-link icon-remove rule-remove-button'});ruleContext.$element.append(_.map(this.conditionSpec,function(condition){return self._renderRuleCondition(ruleContext,condition);}),$removeButton).appendTo($ruleList);ruleContext.$element.data('ruleContext',ruleContext);this.conditionSpec.forEach(function(condition){self._setConditionOption(ruleContext,condition.value,rule[condition.value]);});this._checkConditionIncompatibility(ruleContext);this._checkPlaceholder();this.element.trigger('change');},_removeRule:function($elem){var rule=$elem.data('ruleContext').rule;this.ruleData=_.without(this.ruleData,_.find(this.ruleData,_.partial(_.isEqual,rule)));$elem.remove();this._checkPlaceholder();this.element.trigger('change');},_addNewRule:function($ruleList){var newRule={};this.ruleData.push(newRule);this._addRule($ruleList,newRule);},_create:function(){var self=this;var $container=this.options.containerElement;var $addNewRuleButton=$container.find('.js-add-new-rule');var $ruleList=this.options.containerElement.find('.rule-list');this.ruleData=JSON.parse(this.element.val());this.conditionSpec=_.map(this.options.conditionTypes,function(type){var item=self.options.conditionChoices[type];item['value']=type;return item;});$addNewRuleButton.on('click',function(e){self._addNewRule($ruleList);e.preventDefault();});$container.on('click','.rule-remove-button',function(){var $elem=$(this).closest('.rule');self._removeRule($elem);});this.ruleData.forEach(function(rule){self._addRule($ruleList,rule);});this.element.on('change',this._onChange.bind(this));}});})(jQuery);
p1
.