V"use strict";var Markdown;if(typeof exports==="object"&&typeof require==="function")\u000aMarkdown=exports;else\u000aMarkdown={};(function(){function identity(x){return x;}\u000afunction returnFalse(x){return false;}\u000afunction HookCollection(){}\u000aHookCollection.prototype={chain:function(hookname,func){var original=this[hookname];if(!original)\u000athrow new Error("unknown hook "+hookname);if(original===identity)\u000athis[hookname]=func;else\u000athis[hookname]=function(text){var args=Array.prototype.slice.call(arguments,0);args[0]=original.apply(null,args);return func.apply(null,args);};},set:function(hookname,func){if(!this[hookname])\u000athrow new Error("unknown hook "+hookname);this[hookname]=func;},addNoop:function(hookname){this[hookname]=identity;},addFalse:function(hookname){this[hookname]=returnFalse;}};Markdown.HookCollection=HookCollection;function SaveHash(){}\u000aSaveHash.prototype={set:function(key,value){this["s_"+key]=value;},get:function(key){return this["s_"+key];}};Markdown.Converter=function(OPTIONS){var pluginHooks=this.hooks=new HookCollection();pluginHooks.addNoop("plainLinkText");pluginHooks.addNoop("preConversion");pluginHooks.addNoop("postNormalization");pluginHooks.addNoop("preBlockGamut");pluginHooks.addNoop("postBlockGamut");pluginHooks.addNoop("preSpanGamut");pluginHooks.addNoop("postSpanGamut");pluginHooks.addNoop("postConversion");var g_urls;var g_titles;var g_html_blocks;var g_list_level;OPTIONS=OPTIONS||{};var asciify=identity,deasciify=identity;if(OPTIONS.nonAsciiLetters){(function(){var lettersThatJavaScriptDoesNotKnowAndQ=/[Q\u005cu00aa\u005cu00b5\u005cu00ba\u005cu00c0-\u005cu00d6\u005cu00d8-\u005cu00f6\u005cu00f8-\u005cu02c1\u005cu02c6-\u005cu02d1\u005cu02e0-\u005cu02e4\u005cu02ec\u005cu02ee\u005cu0370-\u005cu0374\u005cu0376-\u005cu0377\u005cu037a-\u005cu037d\u005cu0386\u005cu0388-\u005cu038a\u005cu038c\u005cu038e-\u005cu03a1\u005cu03a3-\u005cu03f5\u005cu03f7-\u005cu0481\u005cu048a-\u005cu0523\u005cu0531-\u005cu0556\u005cu0559\u005cu0561-\u005cu0587\u005cu05d0-\u005cu05ea\u005cu05f0-\u005cu05f2\u005cu0621-\u005cu064a\u005cu0660-\u005cu0669\u005cu066e-\u005cu066f\u005cu0671-\u005cu06d3\u005cu06d5\u005cu06e5-\u005cu06e6\u005cu06ee-\u005cu06fc\u005cu06ff\u005cu0710\u005cu0712-\u005cu072f\u005cu074d-\u005cu07a5\u005cu07b1\u005cu07c0-\u005cu07ea\u005cu07f4-\u005cu07f5\u005cu07fa\u005cu0904-\u005cu0939\u005cu093d\u005cu0950\u005cu0958-\u005cu0961\u005cu0966-\u005cu096f\u005cu0971-\u005cu0972\u005cu097b-\u005cu097f\u005cu0985-\u005cu098c\u005cu098f-\u005cu0990\u005cu0993-\u005cu09a8\u005cu09aa-\u005cu09b0\u005cu09b2\u005cu09b6-\u005cu09b9\u005cu09bd\u005cu09ce\u005cu09dc-\u005cu09dd\u005cu09df-\u005cu09e1\u005cu09e6-\u005cu09f1\u005cu0a05-\u005cu0a0a\u005cu0a0f-\u005cu0a10\u005cu0a13-\u005cu0a28\u005cu0a2a-\u005cu0a30\u005cu0a32-\u005cu0a33\u005cu0a35-\u005cu0a36\u005cu0a38-\u005cu0a39\u005cu0a59-\u005cu0a5c\u005cu0a5e\u005cu0a66-\u005cu0a6f\u005cu0a72-\u005cu0a74\u005cu0a85-\u005cu0a8d\u005cu0a8f-\u005cu0a91\u005cu0a93-\u005cu0aa8\u005cu0aaa-\u005cu0ab0\u005cu0ab2-\u005cu0ab3\u005cu0ab5-\u005cu0ab9\u005cu0abd\u005cu0ad0\u005cu0ae0-\u005cu0ae1\u005cu0ae6-\u005cu0aef\u005cu0b05-\u005cu0b0c\u005cu0b0f-\u005cu0b10\u005cu0b13-\u005cu0b28\u005cu0b2a-\u005cu0b30\u005cu0b32-\u005cu0b33\u005cu0b35-\u005cu0b39\u005cu0b3d\u005cu0b5c-\u005cu0b5d\u005cu0b5f-\u005cu0b61\u005cu0b66-\u005cu0b6f\u005cu0b71\u005cu0b83\u005cu0b85-\u005cu0b8a\u005cu0b8e-\u005cu0b90\u005cu0b92-\u005cu0b95\u005cu0b99-\u005cu0b9a\u005cu0b9c\u005cu0b9e-\u005cu0b9f\u005cu0ba3-\u005cu0ba4\u005cu0ba8-\u005cu0baa\u005cu0bae-\u005cu0bb9\u005cu0bd0\u005cu0be6-\u005cu0bef\u005cu0c05-\u005cu0c0c\u005cu0c0e-\u005cu0c10\u005cu0c12-\u005cu0c28\u005cu0c2a-\u005cu0c33\u005cu0c35-\u005cu0c39\u005cu0c3d\u005cu0c58-\u005cu0c59\u005cu0c60-\u005cu0c61\u005cu0c66-\u005cu0c6f\u005cu0c85-\u005cu0c8c\u005cu0c8e-\u005cu0c90\u005cu0c92-\u005cu0ca8\u005cu0caa-\u005cu0cb3\u005cu0cb5-\u005cu0cb9\u005cu0cbd\u005cu0cde\u005cu0ce0-\u005cu0ce1\u005cu0ce6-\u005cu0cef\u005cu0d05-\u005cu0d0c\u005cu0d0e-\u005cu0d10\u005cu0d12-\u005cu0d28\u005cu0d2a-\u005cu0d39\u005cu0d3d\u005cu0d60-\u005cu0d61\u005cu0d66-\u005cu0d6f\u005cu0d7a-\u005cu0d7f\u005cu0d85-\u005cu0d96\u005cu0d9a-\u005cu0db1\u005cu0db3-\u005cu0dbb\u005cu0dbd\u005cu0dc0-\u005cu0dc6\u005cu0e01-\u005cu0e30\u005cu0e32-\u005cu0e33\u005cu0e40-\u005cu0e46\u005cu0e50-\u005cu0e59\u005cu0e81-\u005cu0e82\u005cu0e84\u005cu0e87-\u005cu0e88\u005cu0e8a\u005cu0e8d\u005cu0e94-\u005cu0e97\u005cu0e99-\u005cu0e9f\u005cu0ea1-\u005cu0ea3\u005cu0ea5\u005cu0ea7\u005cu0eaa-\u005cu0eab\u005cu0ead-\u005cu0eb0\u005cu0eb2-\u005cu0eb3\u005cu0ebd\u005cu0ec0-\u005cu0ec4\u005cu0ec6\u005cu0ed0-\u005cu0ed9\u005cu0edc-\u005cu0edd\u005cu0f00\u005cu0f20-\u005cu0f29\u005cu0f40-\u005cu0f47\u005cu0f49-\u005cu0f6c\u005cu0f88-\u005cu0f8b\u005cu1000-\u005cu102a\u005cu103f-\u005cu1049\u005cu1050-\u005cu1055\u005cu105a-\u005cu105d\u005cu1061\u005cu1065-\u005cu1066\u005cu106e-\u005cu1070\u005cu1075-\u005cu1081\u005cu108e\u005cu1090-\u005cu1099\u005cu10a0-\u005cu10c5\u005cu10d0-\u005cu10fa\u005cu10fc\u005cu1100-\u005cu1159\u005cu115f-\u005cu11a2\u005cu11a8-\u005cu11f9\u005cu1200-\u005cu1248\u005cu124a-\u005cu124d\u005cu1250-\u005cu1256\u005cu1258\u005cu125a-\u005cu125d\u005cu1260-\u005cu1288\u005cu128a-\u005cu128d\u005cu1290-\u005cu12b0\u005cu12b2-\u005cu12b5\u005cu12b8-\u005cu12be\u005cu12c0\u005cu12c2-\u005cu12c5\u005cu12c8-\u005cu12d6\u005cu12d8-\u005cu1310\u005cu1312-\u005cu1315\u005cu1318-\u005cu135a\u005cu1380-\u005cu138f\u005cu13a0-\u005cu13f4\u005cu1401-\u005cu166c\u005cu166f-\u005cu1676\u005cu1681-\u005cu169a\u005cu16a0-\u005cu16ea\u005cu1700-\u005cu170c\u005cu170e-\u005cu1711\u005cu1720-\u005cu1731\u005cu1740-\u005cu1751\u005cu1760-\u005cu176c\u005cu176e-\u005cu1770\u005cu1780-\u005cu17b3\u005cu17d7\u005cu17dc\u005cu17e0-\u005cu17e9\u005cu1810-\u005cu1819\u005cu1820-\u005cu1877\u005cu1880-\u005cu18a8\u005cu18aa\u005cu1900-\u005cu191c\u005cu1946-\u005cu196d\u005cu1970-\u005cu1974\u005cu1980-\u005cu19a9\u005cu19c1-\u005cu19c7\u005cu19d0-\u005cu19d9\u005cu1a00-\u005cu1a16\u005cu1b05-\u005cu1b33\u005cu1b45-\u005cu1b4b\u005cu1b50-\u005cu1b59\u005cu1b83-\u005cu1ba0\u005cu1bae-\u005cu1bb9\u005cu1c00-\u005cu1c23\u005cu1c40-\u005cu1c49\u005cu1c4d-\u005cu1c7d\u005cu1d00-\u005cu1dbf\u005cu1e00-\u005cu1f15\u005cu1f18-\u005cu1f1d\u005cu1f20-\u005cu1f45\u005cu1f48-\u005cu1f4d\u005cu1f50-\u005cu1f57\u005cu1f59\u005cu1f5b\u005cu1f5d\u005cu1f5f-\u005cu1f7d\u005cu1f80-\u005cu1fb4\u005cu1fb6-\u005cu1fbc\u005cu1fbe\u005cu1fc2-\u005cu1fc4\u005cu1fc6-\u005cu1fcc\u005cu1fd0-\u005cu1fd3\u005cu1fd6-\u005cu1fdb\u005cu1fe0-\u005cu1fec\u005cu1ff2-\u005cu1ff4\u005cu1ff6-\u005cu1ffc\u005cu203f-\u005cu2040\u005cu2054\u005cu2071\u005cu207f\u005cu2090-\u005cu2094\u005cu2102\u005cu2107\u005cu210a-\u005cu2113\u005cu2115\u005cu2119-\u005cu211d\u005cu2124\u005cu2126\u005cu2128\u005cu212a-\u005cu212d\u005cu212f-\u005cu2139\u005cu213c-\u005cu213f\u005cu2145-\u005cu2149\u005cu214e\u005cu2183-\u005cu2184\u005cu2c00-\u005cu2c2e\u005cu2c30-\u005cu2c5e\u005cu2c60-\u005cu2c6f\u005cu2c71-\u005cu2c7d\u005cu2c80-\u005cu2ce4\u005cu2d00-\u005cu2d25\u005cu2d30-\u005cu2d65\u005cu2d6f\u005cu2d80-\u005cu2d96\u005cu2da0-\u005cu2da6\u005cu2da8-\u005cu2dae\u005cu2db0-\u005cu2db6\u005cu2db8-\u005cu2dbe\u005cu2dc0-\u005cu2dc6\u005cu2dc8-\u005cu2dce\u005cu2dd0-\u005cu2dd6\u005cu2dd8-\u005cu2dde\u005cu2e2f\u005cu3005-\u005cu3006\u005cu3031-\u005cu3035\u005cu303b-\u005cu303c\u005cu3041-\u005cu3096\u005cu309d-\u005cu309f\u005cu30a1-\u005cu30fa\u005cu30fc-\u005cu30ff\u005cu3105-\u005cu312d\u005cu3131-\u005cu318e\u005cu31a0-\u005cu31b7\u005cu31f0-\u005cu31ff\u005cu3400-\u005cu4db5\u005cu4e00-\u005cu9fc3\u005cua000-\u005cua48c\u005cua500-\u005cua60c\u005cua610-\u005cua62b\u005cua640-\u005cua65f\u005cua662-\u005cua66e\u005cua67f-\u005cua697\u005cua717-\u005cua71f\u005cua722-\u005cua788\u005cua78b-\u005cua78c\u005cua7fb-\u005cua801\u005cua803-\u005cua805\u005cua807-\u005cua80a\u005cua80c-\u005cua822\u005cua840-\u005cua873\u005cua882-\u005cua8b3\u005cua8d0-\u005cua8d9\u005cua900-\u005cua925\u005cua930-\u005cua946\u005cuaa00-\u005cuaa28\u005cuaa40-\u005cuaa42\u005cuaa44-\u005cuaa4b\u005cuaa50-\u005cuaa59\u005cuac00-\u005cud7a3\u005cuf900-\u005cufa2d\u005cufa30-\u005cufa6a\u005cufa70-\u005cufad9\u005cufb00-\u005cufb06\u005cufb13-\u005cufb17\u005cufb1d\u005cufb1f-\u005cufb28\u005cufb2a-\u005cufb36\u005cufb38-\u005cufb3c\u005cufb3e\u005cufb40-\u005cufb41\u005cufb43-\u005cufb44\u005cufb46-\u005cufbb1\u005cufbd3-\u005cufd3d\u005cufd50-\u005cufd8f\u005cufd92-\u005cufdc7\u005cufdf0-\u005cufdfb\u005cufe33-\u005cufe34\u005cufe4d-\u005cufe4f\u005cufe70-\u005cufe74\u005cufe76-\u005cufefc\u005cuff10-\u005cuff19\u005cuff21-\u005cuff3a\u005cuff3f\u005cuff41-\u005cuff5a\u005cuff66-\u005cuffbe\u005cuffc2-\u005cuffc7\u005cuffca-\u005cuffcf\u005cuffd2-\u005cuffd7\u005cuffda-\u005cuffdc]/g;var cp_Q="Q".charCodeAt(0);var cp_A="A".charCodeAt(0);var cp_Z="Z".charCodeAt(0);var dist_Za="a".charCodeAt(0)-cp_Z-1;asciify=function(text){return text.replace(lettersThatJavaScriptDoesNotKnowAndQ,function(m){var c=m.charCodeAt(0);var s="";var v;while(c>0){v=(c%51)+cp_A;if(v>=cp_Q)\u000av++;if(v>cp_Z)\u000av+=dist_Za;s=String.fromCharCode(v)+s;c=c/51|0;}\u000areturn"Q"+s+"Q";})};deasciify=function(text){return text.replace(/Q([A-PR-Za-z]{1,3})Q/g,function(m,s){var c=0;var v;for(var i=0;i<s.length;i++){v=s.charCodeAt(i);if(v>cp_Z)\u000av-=dist_Za;if(v>cp_Q)\u000av--;v-=cp_A;c=(c*51)+v;}\u000areturn String.fromCharCode(c);})}})();}\u000avar _DoItalicsAndBold=OPTIONS.asteriskIntraWordEmphasis?_DoItalicsAndBold_AllowIntrawordWithAsterisk:_DoItalicsAndBoldStrict;this.makeHtml=function(text){if(g_urls)\u000athrow new Error("Recursive call to converter.makeHtml");g_urls=new SaveHash();g_titles=new SaveHash();g_html_blocks=[];g_list_level=0;text=pluginHooks.preConversion(text);text=text.replace(/~/g,"~T");text=text.replace(/\u005c$/g,"~D");text=text.replace(/\u005cr\u005cn/g,"\u005cn");text=text.replace(/\u005cr/g,"\u005cn");text="\u005cn\u005cn"+text+"\u005cn\u005cn";text=_Detab(text);text=text.replace(/^[ \u005ct]+$/mg,"");text=pluginHooks.postNormalization(text);text=_HashHTMLBlocks(text);text=_StripLinkDefinitions(text);text=_RunBlockGamut(text);text=_UnescapeSpecialChars(text);text=text.replace(/~D/g,"$$");text=text.replace(/~T/g,"~");text=pluginHooks.postConversion(text);g_html_blocks=g_titles=g_urls=null;return text;};function _StripLinkDefinitions(text){text=text.replace(/^[ ]{0,3}\u005c[([^\u005c[\u005c]]+)\u005c]:[ \u005ct]*\u005cn?[ \u005ct]*<?(\u005cS+?)>?(?=\u005cs|$)[ \u005ct]*\u005cn?[ \u005ct]*((\u005cn*)["(](.+?)[")][ \u005ct]*)?(\u005cn+)/gm,function(wholeMatch,m1,m2,m3,m4,m5,m6){m1=m1.toLowerCase();g_urls.set(m1,_EncodeAmpsAndAngles(m2));if(m4){return m3+m6;}else if(m5){g_titles.set(m1,m5.replace(/"/g,"&quot;"));}\u000areturn"";});return text;}\u000afunction _HashHTMLBlocks(text){var block_tags_a="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del"\u000avar block_tags_b="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math"\u000atext=text.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\u005cb[^\u005cr]*?\u005cn<\u005c/\u005c2>[ \u005ct]*(?=\u005cn+))/gm,hashMatch);text=text.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\u005cb[^\u005cr]*?.*<\u005c/\u005c2>[ \u005ct]*(?=\u005cn+)\u005cn)/gm,hashMatch);text=text.replace(/\u005cn[ ]{0,3}((<(hr)\u005cb([^<>])*?\u005c/?>)[ \u005ct]*(?=\u005cn{2,}))/g,hashMatch);text=text.replace(/\u005cn\u005cn[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \u005ct]*(?=\u005cn{2,}))/g,hashMatch);text=text.replace(/(?:\u005cn\u005cn)([ ]{0,3}(?:<([?%])[^\u005cr]*?\u005c2>)[ \u005ct]*(?=\u005cn{2,}))/g,hashMatch);return text;}\u000afunction hashBlock(text){text=text.replace(/(^\u005cn+|\u005cn+$)/g,"");return"\u005cn\u005cn~K"+(g_html_blocks.push(text)-1)+"K\u005cn\u005cn";}\u000afunction hashMatch(wholeMatch,m1){return hashBlock(m1);}\u000avar blockGamutHookCallback=function(t){return _RunBlockGamut(t);}\u000afunction _RunBlockGamut(text,doNotUnhash,doNotCreateParagraphs){text=pluginHooks.preBlockGamut(text,blockGamutHookCallback);text=_DoHeaders(text);var replacement="<hr />\u005cn";text=text.replace(/^[ ]{0,2}([ ]?\u005c*[ ]?){3,}[ \u005ct]*$/gm,replacement);text=text.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \u005ct]*$/gm,replacement);text=text.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \u005ct]*$/gm,replacement);text=_DoLists(text);text=_DoCodeBlocks(text);text=_DoBlockQuotes(text);text=pluginHooks.postBlockGamut(text,blockGamutHookCallback);text=_HashHTMLBlocks(text);text=_FormParagraphs(text,doNotUnhash,doNotCreateParagraphs);return text;}\u000afunction _RunSpanGamut(text){text=pluginHooks.preSpanGamut(text);text=_DoCodeSpans(text);text=_EscapeSpecialCharsWithinTagAttributes(text);text=_EncodeBackslashEscapes(text);text=_DoImages(text);text=_DoAnchors(text);text=_DoAutoLinks(text);text=text.replace(/~P/g,"://");text=_EncodeAmpsAndAngles(text);text=_DoItalicsAndBold(text);text=text.replace(/  +\u005cn/g," <br>\u005cn");text=pluginHooks.postSpanGamut(text);return text;}\u000afunction _EscapeSpecialCharsWithinTagAttributes(text){var regex=/(<[a-z\u005c/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;text=text.replace(regex,function(wholeMatch){var tag=wholeMatch.replace(/(.)<\u005c/?code>(?=.)/g,"$1`");tag=escapeCharacters(tag,wholeMatch.charAt(1)=="!"?"\u005c\u005c`*_/":"\u005c\u005c`*_");return tag;});return text;}\u000afunction _DoAnchors(text){if(text.indexOf("[")===-1)\u000areturn text;text=text.replace(/(\u005c[((?:\u005c[[^\u005c]]*\u005c]|[^\u005c[\u005c]])*)\u005c][ ]?(?:\u005cn[ ]*)?\u005c[(.*?)\u005c])()()()()/g,writeAnchorTag);text=text.replace(/(\u005c[((?:\u005c[[^\u005c]]*\u005c]|[^\u005c[\u005c]])*)\u005c]\u005c([ \u005ct]*()<?((?:\u005c([^)]*\u005c)|[^()\u005cs])*?)>?[ \u005ct]*((['"])(.*?)\u005c6[ \u005ct]*)?\u005c))/g,writeAnchorTag);text=text.replace(/(\u005c[([^\u005c[\u005c]]+)\u005c])()()()()()/g,writeAnchorTag);return text;}\u000afunction writeAnchorTag(wholeMatch,m1,m2,m3,m4,m5,m6,m7){if(m7==undefined)m7="";var whole_match=m1;var link_text=m2.replace(/:\u005c/\u005c//g,"~P");var link_id=m3.toLowerCase();var url=m4;var title=m7;if(url==""){if(link_id==""){link_id=link_text.toLowerCase().replace(/ ?\u005cn/g," ");}\u000aurl="#"+link_id;if(g_urls.get(link_id)!=undefined){url=g_urls.get(link_id);if(g_titles.get(link_id)!=undefined){title=g_titles.get(link_id);}}\u000aelse{if(whole_match.search(/\u005c(\u005cs*\u005c)$/m)>-1){url="";}else{return whole_match;}}}\u000aurl=attributeSafeUrl(url);var result="<a href=\u005c""+url+"\u005c"";if(title!=""){title=attributeEncode(title);title=escapeCharacters(title,"*_");result+=" title=\u005c""+title+"\u005c"";}\u000aresult+=">"+link_text+"</a>";return result;}\u000afunction _DoImages(text){if(text.indexOf("![")===-1)\u000areturn text;text=text.replace(/(!\u005c[(.*?)\u005c][ ]?(?:\u005cn[ ]*)?\u005c[(.*?)\u005c])()()()()/g,writeImageTag);text=text.replace(/(!\u005c[(.*?)\u005c]\u005cs?\u005c([ \u005ct]*()<?(\u005cS+?)>?[ \u005ct]*((['"])(.*?)\u005c6[ \u005ct]*)?\u005c))/g,writeImageTag);return text;}\u000afunction attributeEncode(text){return text.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");}\u000afunction writeImageTag(wholeMatch,m1,m2,m3,m4,m5,m6,m7){var whole_match=m1;var alt_text=m2;var link_id=m3.toLowerCase();var url=m4;var title=m7;if(!title)title="";if(url==""){if(link_id==""){link_id=alt_text.toLowerCase().replace(/ ?\u005cn/g," ");}\u000aurl="#"+link_id;if(g_urls.get(link_id)!=undefined){url=g_urls.get(link_id);if(g_titles.get(link_id)!=undefined){title=g_titles.get(link_id);}}\u000aelse{return whole_match;}}\u000aalt_text=escapeCharacters(attributeEncode(alt_text),"*_[]()");url=escapeCharacters(url,"*_");var result="<img src=\u005c""+url+"\u005c" alt=\u005c""+alt_text+"\u005c"";title=attributeEncode(title);title=escapeCharacters(title,"*_");result+=" title=\u005c""+title+"\u005c"";result+=" />";return result;}\u000afunction _DoHeaders(text){text=text.replace(/^(.+)[ \u005ct]*\u005cn=+[ \u005ct]*\u005cn+/gm,function(wholeMatch,m1){return"<h1>"+_RunSpanGamut(m1)+"</h1>\u005cn\u005cn";});text=text.replace(/^(.+)[ \u005ct]*\u005cn-+[ \u005ct]*\u005cn+/gm,function(matchFound,m1){return"<h2>"+_RunSpanGamut(m1)+"</h2>\u005cn\u005cn";});text=text.replace(/^(\u005c#{1,6})[ \u005ct]*(.+?)[ \u005ct]*\u005c#*\u005cn+/gm,function(wholeMatch,m1,m2){var h_level=m1.length;return"<h"+h_level+">"+_RunSpanGamut(m2)+"</h"+h_level+">\u005cn\u005cn";});return text;}\u000afunction _DoLists(text,isInsideParagraphlessListItem){text+="~0";var whole_list=/^(([ ]{0,3}([*+-]|\u005cd+[.])[ \u005ct]+)[^\u005cr]+?(~0|\u005cn{2,}(?=\u005cS)(?![ \u005ct]*(?:[*+-]|\u005cd+[.])[ \u005ct]+)))/gm;if(g_list_level){text=text.replace(whole_list,function(wholeMatch,m1,m2){var list=m1;var list_type=(m2.search(/[*+-]/g)>-1)?"ul":"ol";var first_number;if(list_type==="ol")\u000afirst_number=parseInt(m2,10)\u000avar result=_ProcessListItems(list,list_type,isInsideParagraphlessListItem);result=result.replace(/\u005cs+$/,"");var opening="<"+list_type;if(first_number&&first_number!==1)\u000aopening+=" start=\u005c""+first_number+"\u005c"";result=opening+">"+result+"</"+list_type+">\u005cn";return result;});}else{whole_list=/(\u005cn\u005cn|^\u005cn?)(([ ]{0,3}([*+-]|\u005cd+[.])[ \u005ct]+)[^\u005cr]+?(~0|\u005cn{2,}(?=\u005cS)(?![ \u005ct]*(?:[*+-]|\u005cd+[.])[ \u005ct]+)))/g;text=text.replace(whole_list,function(wholeMatch,m1,m2,m3){var runup=m1;var list=m2;var list_type=(m3.search(/[*+-]/g)>-1)?"ul":"ol";var first_number;if(list_type==="ol")\u000afirst_number=parseInt(m3,10)\u000avar result=_ProcessListItems(list,list_type);var opening="<"+list_type;if(first_number&&first_number!==1)\u000aopening+=" start=\u005c""+first_number+"\u005c"";result=runup+opening+">\u005cn"+result+"</"+list_type+">\u005cn";return result;});}\u000atext=text.replace(/~0/,"");return text;}\u000avar _listItemMarkers={ol:"\u005c\u005cd+[.]",ul:"[*+-]"};function _ProcessListItems(list_str,list_type,isInsideParagraphlessListItem){g_list_level++;list_str=list_str.replace(/\u005cn{2,}$/,"\u005cn");list_str+="~0";var marker=_listItemMarkers[list_type];var re=new RegExp("(^[ \u005c\u005ct]*)("+marker+")[ \u005c\u005ct]+([^\u005c\u005cr]+?(\u005c\u005cn+))(?=(~0|\u005c\u005c1("+marker+")[ \u005c\u005ct]+))","gm");var last_item_had_a_double_newline=false;list_str=list_str.replace(re,function(wholeMatch,m1,m2,m3){var item=m3;var leading_space=m1;var ends_with_double_newline=/\u005cn\u005cn$/.test(item);var contains_double_newline=ends_with_double_newline||item.search(/\u005cn{2,}/)>-1;var loose=contains_double_newline||last_item_had_a_double_newline;item=_RunBlockGamut(_Outdent(item),true,!loose);last_item_had_a_double_newline=ends_with_double_newline;return"<li>"+item+"</li>\u005cn";});list_str=list_str.replace(/~0/g,"");g_list_level--;return list_str;}\u000afunction _DoCodeBlocks(text){text+="~0";text=text.replace(/(?:\u005cn\u005cn|^\u005cn?)((?:(?:[ ]{4}|\u005ct).*\u005cn+)+)(\u005cn*[ ]{0,3}[^ \u005ct\u005cn]|(?=~0))/g,function(wholeMatch,m1,m2){var codeblock=m1;var nextChar=m2;codeblock=_EncodeCode(_Outdent(codeblock));codeblock=_Detab(codeblock);codeblock=codeblock.replace(/^\u005cn+/g,"");codeblock=codeblock.replace(/\u005cn+$/g,"");codeblock="<pre><code>"+codeblock+"\u005cn</code></pre>";return"\u005cn\u005cn"+codeblock+"\u005cn\u005cn"+nextChar;});text=text.replace(/~0/,"");return text;}\u000afunction _DoCodeSpans(text){text=text.replace(/(^|[^\u005c\u005c`])(`+)(?!`)([^\u005cr]*?[^`])\u005c2(?!`)/gm,function(wholeMatch,m1,m2,m3,m4){var c=m3;c=c.replace(/^([ \u005ct]*)/g,"");c=c.replace(/[ \u005ct]*$/g,"");c=_EncodeCode(c);c=c.replace(/:\u005c/\u005c//g,"~P");return m1+"<code>"+c+"</code>";});return text;}\u000afunction _EncodeCode(text){text=text.replace(/&/g,"&amp;");text=text.replace(/</g,"&lt;");text=text.replace(/>/g,"&gt;");text=escapeCharacters(text,"\u005c*_{}[]\u005c\u005c",false);return text;}\u000afunction _DoItalicsAndBoldStrict(text){if(text.indexOf("*")===-1&&text.indexOf("_")===-1)\u000areturn text;text=asciify(text);text=text.replace(/(^|[\u005cW_])(?:(?!\u005c1)|(?=^))(\u005c*|_)\u005c2(?=\u005cS)([^\u005cr]*?\u005cS)\u005c2\u005c2(?!\u005c2)(?=[\u005cW_]|$)/g,"$1<strong>$3</strong>");text=text.replace(/(^|[\u005cW_])(?:(?!\u005c1)|(?=^))(\u005c*|_)(?=\u005cS)((?:(?!\u005c2)[^\u005cr])*?\u005cS)\u005c2(?!\u005c2)(?=[\u005cW_]|$)/g,"$1<em>$3</em>");return deasciify(text);}\u000afunction _DoItalicsAndBold_AllowIntrawordWithAsterisk(text){if(text.indexOf("*")===-1&&text.indexOf("_")===-1)\u000areturn text;text=asciify(text);text=text.replace(/(?=[^\u005cr][*_]|[*_])(^|(?=\u005cW__|(?!\u005c*)[\u005cW_]\u005c*\u005c*|\u005cw\u005c*\u005c*\u005cw)[^\u005cr])(\u005c*\u005c*|__)(?!\u005c2)(?=\u005cS)((?:|[^\u005cr]*?(?!\u005c2)[^\u005cr])(?=\u005cS_|\u005cw|\u005cS\u005c*\u005c*(?:[\u005cW_]|$)).)(?=__(?:\u005cW|$)|\u005c*\u005c*(?:[^*]|$))\u005c2/g,"$1<strong>$3</strong>");text=text.replace(/(?=[^\u005cr][*_]|[*_])(^|(?=\u005cW_|(?!\u005c*)(?:[\u005cW_]\u005c*|\u005cD\u005c*(?=\u005cw)\u005cD))[^\u005cr])(\u005c*|_)(?!\u005c2\u005c2\u005c2)(?=\u005cS)((?:(?!\u005c2)[^\u005cr])*?(?=[^\u005cs_]_|(?=\u005cw)\u005cD\u005c*\u005cD|[^\u005cs*]\u005c*(?:[\u005cW_]|$)).)(?=_(?:\u005cW|$)|\u005c*(?:[^*]|$))\u005c2/g,"$1<em>$3</em>");return deasciify(text);}\u000afunction _DoBlockQuotes(text){text=text.replace(/((^[ \u005ct]*>[ \u005ct]?.+\u005cn(.+\u005cn)*\u005cn*)+)/gm,function(wholeMatch,m1){var bq=m1;bq=bq.replace(/^[ \u005ct]*>[ \u005ct]?/gm,"~0");bq=bq.replace(/~0/g,"");bq=bq.replace(/^[ \u005ct]+$/gm,"");bq=_RunBlockGamut(bq);bq=bq.replace(/(^|\u005cn)/g,"$1  ");bq=bq.replace(/(\u005cs*<pre>[^\u005cr]+?<\u005c/pre>)/gm,function(wholeMatch,m1){var pre=m1;pre=pre.replace(/^  /mg,"~0");pre=pre.replace(/~0/g,"");return pre;});return hashBlock("<blockquote>\u005cn"+bq+"\u005cn</blockquote>");});return text;}\u000afunction _FormParagraphs(text,doNotUnhash,doNotCreateParagraphs){text=text.replace(/^\u005cn+/g,"");text=text.replace(/\u005cn+$/g,"");var grafs=text.split(/\u005cn{2,}/g);var grafsOut=[];var markerRe=/~K(\u005cd+)K/;var end=grafs.length;for(var i=0;i<end;i++){var str=grafs[i];if(markerRe.test(str)){grafsOut.push(str);}\u000aelse if(/\u005cS/.test(str)){str=_RunSpanGamut(str);str=str.replace(/^([ \u005ct]*)/g,doNotCreateParagraphs?"":"<p>");if(!doNotCreateParagraphs)\u000astr+="</p>"\u000agrafsOut.push(str);}}\u000aif(!doNotUnhash){end=grafsOut.length;for(var i=0;i<end;i++){var foundAny=true;while(foundAny){foundAny=false;grafsOut[i]=grafsOut[i].replace(/~K(\u005cd+)K/g,function(wholeMatch,id){foundAny=true;return g_html_blocks[id];});}}}\u000areturn grafsOut.join("\u005cn\u005cn");}\u000afunction _EncodeAmpsAndAngles(text){text=text.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\u005cw+);)/g,"&amp;");text=text.replace(/<(?![a-z\u005c/?!]|~D)/gi,"&lt;");return text;}\u000afunction _EncodeBackslashEscapes(text){text=text.replace(/\u005c\u005c(\u005c\u005c)/g,escapeCharacters_callback);text=text.replace(/\u005c\u005c([`*_{}\u005c[\u005c]()>#+-.!])/g,escapeCharacters_callback);return text;}\u000avar charInsideUrl="[-A-Z0-9+&@#/%?=~_|[\u005c\u005c]()!:,.;]",charEndingUrl="[-A-Z0-9+&@#/%=~_|[\u005c\u005c])]",autoLinkRegex=new RegExp("(=\u005c"|<)?\u005c\u005cb(https?|ftp)(://"+charInsideUrl+"*"+charEndingUrl+")(?=$|\u005c\u005cW)","gi"),endCharRegex=new RegExp(charEndingUrl,"i");function handleTrailingParens(wholeMatch,lookbehind,protocol,link){if(lookbehind)\u000areturn wholeMatch;if(link.charAt(link.length-1)!==")")\u000areturn"<"+protocol+link+">";var parens=link.match(/[()]/g);var level=0;for(var i=0;i<parens.length;i++){if(parens[i]==="("){if(level<=0)\u000alevel=1;else\u000alevel++;}\u000aelse{level--;}}\u000avar tail="";if(level<0){var re=new RegExp("\u005c\u005c){1,"+(-level)+"}$");link=link.replace(re,function(trailingParens){tail=trailingParens;return"";});}\u000aif(tail){var lastChar=link.charAt(link.length-1);if(!endCharRegex.test(lastChar)){tail=lastChar+tail;link=link.substr(0,link.length-1);}}\u000areturn"<"+protocol+link+">"+tail;}\u000afunction _DoAutoLinks(text){text=text.replace(autoLinkRegex,handleTrailingParens);var replacer=function(wholematch,m1){var url=attributeSafeUrl(m1);return"<a href=\u005c""+url+"\u005c">"+pluginHooks.plainLinkText(m1)+"</a>";};text=text.replace(/<((https?|ftp):[^'">\u005cs]+)>/gi,replacer);return text;}\u000afunction _UnescapeSpecialChars(text){text=text.replace(/~E(\u005cd+)E/g,function(wholeMatch,m1){var charCodeToReplace=parseInt(m1);return String.fromCharCode(charCodeToReplace);});return text;}\u000afunction _Outdent(text){text=text.replace(/^(\u005ct|[ ]{1,4})/gm,"~0");text=text.replace(/~0/g,"")\u000areturn text;}\u000afunction _Detab(text){if(!/\u005ct/.test(text))\u000areturn text;var spaces=["    ","   ","  "," "],skew=0,v;return text.replace(/[\u005cn\u005ct]/g,function(match,offset){if(match==="\u005cn"){skew=offset+1;return match;}\u000av=(offset-skew)%4;skew=offset+1;return spaces[v];});}\u000afunction attributeSafeUrl(url){url=attributeEncode(url);url=escapeCharacters(url,"*_:()[]")\u000areturn url;}\u000afunction escapeCharacters(text,charsToEscape,afterBackslash){var regexString="(["+charsToEscape.replace(/([\u005c[\u005c]\u005c\u005c])/g,"\u005c\u005c$1")+"])";if(afterBackslash){regexString="\u005c\u005c\u005c\u005c"+regexString;}\u000avar regex=new RegExp(regexString,"g");text=text.replace(regex,escapeCharacters_callback);return text;}\u000afunction escapeCharacters_callback(wholeMatch,m1){var charCodeToEscape=m1.charCodeAt(0);return"~E"+charCodeToEscape+"E";}};})();\ufeff\u000a(function(){var util={},position={},ui={},doc=window.document,re=window.RegExp,nav=window.navigator,SETTINGS={lineLength:72},uaSniffed={isIE:/msie/.test(nav.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(nav.userAgent.toLowerCase())||/msie 5/.test(nav.userAgent.toLowerCase()),isOpera:/opera/.test(nav.userAgent.toLowerCase())};var defaultsStrings={bold:"Strong <strong> Ctrl+B",boldexample:"strong text",italic:"Emphasis <em> Ctrl+I",italicexample:"emphasized text",link:"Hyperlink <a> Ctrl+L",linkdescription:"enter link description here",linkdialog:"<p><b>Insert Hyperlink</b></p><p>http://example.com/ \u005c"optional title\u005c"</p>",quote:"Blockquote <blockquote> Ctrl+Q",quoteexample:"Blockquote",code:"Code Sample <pre><code> Ctrl+K",codeexample:"enter code here",image:"Image <img> Ctrl+G",imagedescription:"enter image description here",imagedialog:"<p><b>Insert Image</b></p><p>http://example.com/images/diagram.jpg \u005c"optional title\u005c"<br><br>Need <a href='http://www.google.com/search?q=free+image+hosting' target='_blank'>free image hosting?</a></p>",olist:"Numbered List <ol> Ctrl+O",ulist:"Bulleted List <ul> Ctrl+U",litem:"List item",heading:"Heading <h1>/<h2> Ctrl+H",headingexample:"Heading",hr:"Horizontal Rule <hr> Ctrl+R",undo:"Undo - Ctrl+Z",redo:"Redo - Ctrl+Y",redomac:"Redo - Ctrl+Shift+Z",help:"Markdown Editing Help"};var imageDefaultText="http://";var linkDefaultText="http://";Markdown.Editor=function(markdownConverter,idPostfix,options){options=options||{};if(typeof options.handler==="function"){options={helpButton:options};}\u000aoptions.strings=options.strings||{};if(options.helpButton){options.strings.help=options.strings.help||options.helpButton.title;}\u000avar getString=function(identifier){return options.strings[identifier]||defaultsStrings[identifier];}\u000aidPostfix=idPostfix||"";var hooks=this.hooks=new Markdown.HookCollection();hooks.addNoop("onPreviewRefresh");hooks.addNoop("postBlockquoteCreation");hooks.addFalse("insertImageDialog");this.getConverter=function(){return markdownConverter;}\u000avar that=this,panels;this.run=function(){if(panels)\u000areturn;panels=new PanelCollection(idPostfix);var commandManager=new CommandManager(hooks,getString,markdownConverter);var previewManager=new PreviewManager(markdownConverter,panels,function(){hooks.onPreviewRefresh();});var undoManager,uiManager;if(!/\u005c?noundo/.test(doc.location.href)){undoManager=new UndoManager(function(){previewManager.refresh();if(uiManager)\u000auiManager.setUndoRedoButtonStates();},panels);this.textOperation=function(f){undoManager.setCommandMode();f();that.refreshPreview();}}\u000auiManager=new UIManager(idPostfix,panels,undoManager,previewManager,commandManager,options.helpButton,getString);uiManager.setUndoRedoButtonStates();var forceRefresh=that.refreshPreview=function(){previewManager.refresh(true);};forceRefresh();};}\u000afunction Chunks(){}\u000aChunks.prototype.findTags=function(startRegex,endRegex){var chunkObj=this;var regex;if(startRegex){regex=util.extendRegExp(startRegex,"","$");this.before=this.before.replace(regex,function(match){chunkObj.startTag=chunkObj.startTag+match;return"";});regex=util.extendRegExp(startRegex,"^","");this.selection=this.selection.replace(regex,function(match){chunkObj.startTag=chunkObj.startTag+match;return"";});}\u000aif(endRegex){regex=util.extendRegExp(endRegex,"","$");this.selection=this.selection.replace(regex,function(match){chunkObj.endTag=match+chunkObj.endTag;return"";});regex=util.extendRegExp(endRegex,"^","");this.after=this.after.replace(regex,function(match){chunkObj.endTag=match+chunkObj.endTag;return"";});}};Chunks.prototype.trimWhitespace=function(remove){var beforeReplacer,afterReplacer,that=this;if(remove){beforeReplacer=afterReplacer="";}else{beforeReplacer=function(s){that.before+=s;return"";}\u000aafterReplacer=function(s){that.after=s+that.after;return"";}}\u000athis.selection=this.selection.replace(/^(\u005cs*)/,beforeReplacer).replace(/(\u005cs*)$/,afterReplacer);};Chunks.prototype.skipLines=function(nLinesBefore,nLinesAfter,findExtraNewlines){if(nLinesBefore===undefined){nLinesBefore=1;}\u000aif(nLinesAfter===undefined){nLinesAfter=1;}\u000anLinesBefore++;nLinesAfter++;var regexText;var replacementText;if(navigator.userAgent.match(/Chrome/)){"X".match(/()./);}\u000athis.selection=this.selection.replace(/(^\u005cn*)/,"");this.startTag=this.startTag+re.$1;this.selection=this.selection.replace(/(\u005cn*$)/,"");this.endTag=this.endTag+re.$1;this.startTag=this.startTag.replace(/(^\u005cn*)/,"");this.before=this.before+re.$1;this.endTag=this.endTag.replace(/(\u005cn*$)/,"");this.after=this.after+re.$1;if(this.before){regexText=replacementText="";while(nLinesBefore--){regexText+="\u005c\u005cn?";replacementText+="\u005cn";}\u000aif(findExtraNewlines){regexText="\u005c\u005cn*";}\u000athis.before=this.before.replace(new re(regexText+"$",""),replacementText);}\u000aif(this.after){regexText=replacementText="";while(nLinesAfter--){regexText+="\u005c\u005cn?";replacementText+="\u005cn";}\u000aif(findExtraNewlines){regexText="\u005c\u005cn*";}\u000athis.after=this.after.replace(new re(regexText,""),replacementText);}};function PanelCollection(postfix){this.buttonBar=doc.getElementById("wmd-button-bar"+postfix);this.preview=doc.getElementById("wmd-preview"+postfix);this.input=doc.getElementById("wmd-input"+postfix);};util.isVisible=function(elem){if(window.getComputedStyle){return window.getComputedStyle(elem,null).getPropertyValue("display")!=="none";}\u000aelse if(elem.currentStyle){return elem.currentStyle["display"]!=="none";}};util.addEvent=function(elem,event,listener){if(elem.attachEvent){elem.attachEvent("on"+event,listener);}\u000aelse{elem.addEventListener(event,listener,false);}};util.removeEvent=function(elem,event,listener){if(elem.detachEvent){elem.detachEvent("on"+event,listener);}\u000aelse{elem.removeEventListener(event,listener,false);}};util.fixEolChars=function(text){text=text.replace(/\u005cr\u005cn/g,"\u005cn");text=text.replace(/\u005cr/g,"\u005cn");return text;};util.extendRegExp=function(regex,pre,post){if(pre===null||pre===undefined){pre="";}\u000aif(post===null||post===undefined){post="";}\u000avar pattern=regex.toString();var flags;pattern=pattern.replace(/\u005c/([gim]*)$/,function(wholeMatch,flagsPart){flags=flagsPart;return"";});pattern=pattern.replace(/(^\u005c/|\u005c/$)/g,"");pattern=pre+pattern+post;return new re(pattern,flags);}\u000aposition.getTop=function(elem,isInner){var result=elem.offsetTop;if(!isInner){while(elem=elem.offsetParent){result+=elem.offsetTop;}}\u000areturn result;};position.getHeight=function(elem){return elem.offsetHeight||elem.scrollHeight;};position.getWidth=function(elem){return elem.offsetWidth||elem.scrollWidth;};position.getPageSize=function(){var scrollWidth,scrollHeight;var innerWidth,innerHeight;if(self.innerHeight&&self.scrollMaxY){scrollWidth=doc.body.scrollWidth;scrollHeight=self.innerHeight+self.scrollMaxY;}\u000aelse if(doc.body.scrollHeight>doc.body.offsetHeight){scrollWidth=doc.body.scrollWidth;scrollHeight=doc.body.scrollHeight;}\u000aelse{scrollWidth=doc.body.offsetWidth;scrollHeight=doc.body.offsetHeight;}\u000aif(self.innerHeight){innerWidth=self.innerWidth;innerHeight=self.innerHeight;}\u000aelse if(doc.documentElement&&doc.documentElement.clientHeight){innerWidth=doc.documentElement.clientWidth;innerHeight=doc.documentElement.clientHeight;}\u000aelse if(doc.body){innerWidth=doc.body.clientWidth;innerHeight=doc.body.clientHeight;}\u000avar maxWidth=Math.max(scrollWidth,innerWidth);var maxHeight=Math.max(scrollHeight,innerHeight);return[maxWidth,maxHeight,innerWidth,innerHeight];};function UndoManager(callback,panels){var undoObj=this;var undoStack=[];var stackPtr=0;var mode="none";var lastState;var timer;var inputStateObj;var setMode=function(newMode,noSave){if(mode!=newMode){mode=newMode;if(!noSave){saveState();}}\u000aif(!uaSniffed.isIE||mode!="moving"){timer=setTimeout(refreshState,1);}\u000aelse{inputStateObj=null;}};var refreshState=function(isInitialState){inputStateObj=new TextareaState(panels,isInitialState);timer=undefined;};this.setCommandMode=function(){mode="command";saveState();timer=setTimeout(refreshState,0);};this.canUndo=function(){return stackPtr>1;};this.canRedo=function(){if(undoStack[stackPtr+1]){return true;}\u000areturn false;};this.undo=function(){if(undoObj.canUndo()){if(lastState){lastState.restore();lastState=null;}\u000aelse{undoStack[stackPtr]=new TextareaState(panels);undoStack[--stackPtr].restore();if(callback){callback();}}}\u000amode="none";panels.input.focus();refreshState();};this.redo=function(){if(undoObj.canRedo()){undoStack[++stackPtr].restore();if(callback){callback();}}\u000amode="none";panels.input.focus();refreshState();};var saveState=function(){var currState=inputStateObj||new TextareaState(panels);if(!currState){return false;}\u000aif(mode=="moving"){if(!lastState){lastState=currState;}\u000areturn;}\u000aif(lastState){if(undoStack[stackPtr-1].text!=lastState.text){undoStack[stackPtr++]=lastState;}\u000alastState=null;}\u000aundoStack[stackPtr++]=currState;undoStack[stackPtr+1]=null;if(callback){callback();}};var handleCtrlYZ=function(event){var handled=false;if((event.ctrlKey||event.metaKey)&&!event.altKey){var keyCode=event.charCode||event.keyCode;var keyCodeChar=String.fromCharCode(keyCode);switch(keyCodeChar.toLowerCase()){case"y":undoObj.redo();handled=true;break;case"z":if(!event.shiftKey){undoObj.undo();}\u000aelse{undoObj.redo();}\u000ahandled=true;break;}}\u000aif(handled){if(event.preventDefault){event.preventDefault();}\u000aif(window.event){window.event.returnValue=false;}\u000areturn;}};var handleModeChange=function(event){if(!event.ctrlKey&&!event.metaKey){var keyCode=event.keyCode;if((keyCode>=33&&keyCode<=40)||(keyCode>=63232&&keyCode<=63235)){setMode("moving");}\u000aelse if(keyCode==8||keyCode==46||keyCode==127){setMode("deleting");}\u000aelse if(keyCode==13){setMode("newlines");}\u000aelse if(keyCode==27){setMode("escape");}\u000aelse if((keyCode<16||keyCode>20)&&keyCode!=91){setMode("typing");}}};var setEventHandlers=function(){util.addEvent(panels.input,"keypress",function(event){if((event.ctrlKey||event.metaKey)&&!event.altKey&&(event.keyCode==89||event.keyCode==90)){event.preventDefault();}});var handlePaste=function(){if(uaSniffed.isIE||(inputStateObj&&inputStateObj.text!=panels.input.value)){if(timer==undefined){mode="paste";saveState();refreshState();}}};util.addEvent(panels.input,"keydown",handleCtrlYZ);util.addEvent(panels.input,"keydown",handleModeChange);util.addEvent(panels.input,"mousedown",function(){setMode("moving");});panels.input.onpaste=handlePaste;panels.input.ondrop=handlePaste;};var init=function(){setEventHandlers();refreshState(true);saveState();};init();}\u000afunction TextareaState(panels,isInitialState){var stateObj=this;var inputArea=panels.input;this.init=function(){if(!util.isVisible(inputArea)){return;}\u000aif(!isInitialState&&doc.activeElement&&doc.activeElement!==inputArea){return;}\u000athis.setInputAreaSelectionStartEnd();this.scrollTop=inputArea.scrollTop;if(!this.text&&inputArea.selectionStart||inputArea.selectionStart===0){this.text=inputArea.value;}}\u000athis.setInputAreaSelection=function(){if(!util.isVisible(inputArea)){return;}\u000aif(inputArea.selectionStart!==undefined&&!uaSniffed.isOpera){inputArea.focus();inputArea.selectionStart=stateObj.start;inputArea.selectionEnd=stateObj.end;inputArea.scrollTop=stateObj.scrollTop;}\u000aelse if(doc.selection){if(doc.activeElement&&doc.activeElement!==inputArea){return;}\u000ainputArea.focus();var range=inputArea.createTextRange();range.moveStart("character",-inputArea.value.length);range.moveEnd("character",-inputArea.value.length);range.moveEnd("character",stateObj.end);range.moveStart("character",stateObj.start);range.select();}};this.setInputAreaSelectionStartEnd=function(){if(!panels.ieCachedRange&&(inputArea.selectionStart||inputArea.selectionStart===0)){stateObj.start=inputArea.selectionStart;stateObj.end=inputArea.selectionEnd;}\u000aelse if(doc.selection){stateObj.text=util.fixEolChars(inputArea.value);var range=panels.ieCachedRange||doc.selection.createRange();var fixedRange=util.fixEolChars(range.text);var marker="\u005cx07";var markedRange=marker+fixedRange+marker;range.text=markedRange;var inputText=util.fixEolChars(inputArea.value);range.moveStart("character",-markedRange.length);range.text=fixedRange;stateObj.start=inputText.indexOf(marker);stateObj.end=inputText.lastIndexOf(marker)-marker.length;var len=stateObj.text.length-util.fixEolChars(inputArea.value).length;if(len){range.moveStart("character",-fixedRange.length);while(len--){fixedRange+="\u005cn";stateObj.end+=1;}\u000arange.text=fixedRange;}\u000aif(panels.ieCachedRange)\u000astateObj.scrollTop=panels.ieCachedScrollTop;panels.ieCachedRange=null;this.setInputAreaSelection();}};this.restore=function(){if(stateObj.text!=undefined&&stateObj.text!=inputArea.value){inputArea.value=stateObj.text;}\u000athis.setInputAreaSelection();inputArea.scrollTop=stateObj.scrollTop;};this.getChunks=function(){var chunk=new Chunks();chunk.before=util.fixEolChars(stateObj.text.substring(0,stateObj.start));chunk.startTag="";chunk.selection=util.fixEolChars(stateObj.text.substring(stateObj.start,stateObj.end));chunk.endTag="";chunk.after=util.fixEolChars(stateObj.text.substring(stateObj.end));chunk.scrollTop=stateObj.scrollTop;return chunk;};this.setChunks=function(chunk){chunk.before=chunk.before+chunk.startTag;chunk.after=chunk.endTag+chunk.after;this.start=chunk.before.length;this.end=chunk.before.length+chunk.selection.length;this.text=chunk.before+chunk.selection+chunk.after;this.scrollTop=chunk.scrollTop;};this.init();};function PreviewManager(converter,panels,previewRefreshCallback){var managerObj=this;var timeout;var elapsedTime;var oldInputText;var maxDelay=3000;var startType="delayed";var setupEvents=function(inputElem,listener){util.addEvent(inputElem,"input",listener);inputElem.onpaste=listener;inputElem.ondrop=listener;util.addEvent(inputElem,"keypress",listener);util.addEvent(inputElem,"keydown",listener);};var getDocScrollTop=function(){var result=0;if(window.innerHeight){result=window.pageYOffset;}\u000aelse\u000aif(doc.documentElement&&doc.documentElement.scrollTop){result=doc.documentElement.scrollTop;}\u000aelse\u000aif(doc.body){result=doc.body.scrollTop;}\u000areturn result;};var makePreviewHtml=function(){if(!panels.preview)\u000areturn;var text=panels.input.value;if(text&&text==oldInputText){return;}\u000aelse{oldInputText=text;}\u000avar prevTime=new Date().getTime();text=converter.makeHtml(text);var currTime=new Date().getTime();elapsedTime=currTime-prevTime;pushPreviewHtml(text);};var applyTimeout=function(){if(timeout){clearTimeout(timeout);timeout=undefined;}\u000aif(startType!=="manual"){var delay=0;if(startType==="delayed"){delay=elapsedTime;}\u000aif(delay>maxDelay){delay=maxDelay;}\u000atimeout=setTimeout(makePreviewHtml,delay);}};var getScaleFactor=function(panel){if(panel.scrollHeight<=panel.clientHeight){return 1;}\u000areturn panel.scrollTop/(panel.scrollHeight-panel.clientHeight);};var setPanelScrollTops=function(){if(panels.preview){panels.preview.scrollTop=(panels.preview.scrollHeight-panels.preview.clientHeight)*getScaleFactor(panels.preview);}};this.refresh=function(requiresRefresh){if(requiresRefresh){oldInputText="";makePreviewHtml();}\u000aelse{applyTimeout();}};this.processingTime=function(){return elapsedTime;};var isFirstTimeFilled=true;var ieSafePreviewSet=function(text){var preview=panels.preview;var parent=preview.parentNode;var sibling=preview.nextSibling;parent.removeChild(preview);preview.innerHTML=text;if(!sibling)\u000aparent.appendChild(preview);else\u000aparent.insertBefore(preview,sibling);}\u000avar nonSuckyBrowserPreviewSet=function(text){panels.preview.innerHTML=text;}\u000avar previewSetter;var previewSet=function(text){if(previewSetter)\u000areturn previewSetter(text);try{nonSuckyBrowserPreviewSet(text);previewSetter=nonSuckyBrowserPreviewSet;}catch(e){previewSetter=ieSafePreviewSet;previewSetter(text);}};var pushPreviewHtml=function(text){var emptyTop=position.getTop(panels.input)-getDocScrollTop();if(panels.preview){previewSet(text);previewRefreshCallback();}\u000asetPanelScrollTops();if(isFirstTimeFilled){isFirstTimeFilled=false;return;}\u000avar fullTop=position.getTop(panels.input)-getDocScrollTop();if(uaSniffed.isIE){setTimeout(function(){window.scrollBy(0,fullTop-emptyTop);},0);}\u000aelse{window.scrollBy(0,fullTop-emptyTop);}};var init=function(){setupEvents(panels.input,applyTimeout);makePreviewHtml();if(panels.preview){panels.preview.scrollTop=0;}};init();};ui.createBackground=function(){var background=doc.createElement("div"),style=background.style;background.className="wmd-prompt-background";style.position="absolute";style.top="0";style.zIndex="1000";if(uaSniffed.isIE){style.filter="alpha(opacity=50)";}\u000aelse{style.opacity="0.5";}\u000avar pageSize=position.getPageSize();style.height=pageSize[1]+"px";if(uaSniffed.isIE){style.left=doc.documentElement.scrollLeft;style.width=doc.documentElement.clientWidth;}\u000aelse{style.left="0";style.width="100%";}\u000adoc.body.appendChild(background);return background;};ui.prompt=function(text,defaultInputText,callback){var dialog;var input;if(defaultInputText===undefined){defaultInputText="";}\u000avar checkEscape=function(key){var code=(key.charCode||key.keyCode);if(code===27){if(key.stopPropagation)key.stopPropagation();close(true);return false;}};var close=function(isCancel){util.removeEvent(doc.body,"keyup",checkEscape);var text=input.value;if(isCancel){text=null;}\u000aelse{text=text.replace(/^http:\u005c/\u005c/(https?|ftp):\u005c/\u005c//,'$1://');if(!/^(?:https?|ftp):\u005c/\u005c//.test(text))\u000atext='http://'+text;}\u000adialog.parentNode.removeChild(dialog);callback(text);return false;};var createDialog=function(){dialog=doc.createElement("div");dialog.className="wmd-prompt-dialog";dialog.style.padding="10px;";dialog.style.position="fixed";dialog.style.width="400px";dialog.style.zIndex="1001";var question=doc.createElement("div");question.innerHTML=text;question.style.padding="5px";dialog.appendChild(question);var form=doc.createElement("form"),style=form.style;form.onsubmit=function(){return close(false);};style.padding="0";style.margin="0";style.cssFloat="left";style.width="100%";style.textAlign="center";style.position="relative";dialog.appendChild(form);input=doc.createElement("input");input.type="text";input.value=defaultInputText;style=input.style;style.display="block";style.width="80%";style.marginLeft=style.marginRight="auto";form.appendChild(input);var okButton=doc.createElement("input");okButton.type="button";okButton.onclick=function(){return close(false);};okButton.value="OK";style=okButton.style;style.margin="10px";style.display="inline";style.width="7em";var cancelButton=doc.createElement("input");cancelButton.type="button";cancelButton.onclick=function(){return close(true);};cancelButton.value="Cancel";style=cancelButton.style;style.margin="10px";style.display="inline";style.width="7em";form.appendChild(okButton);form.appendChild(cancelButton);util.addEvent(doc.body,"keyup",checkEscape);dialog.style.top="50%";dialog.style.left="50%";dialog.style.display="block";if(uaSniffed.isIE_5or6){dialog.style.position="absolute";dialog.style.top=doc.documentElement.scrollTop+200+"px";dialog.style.left="50%";}\u000adoc.body.appendChild(dialog);dialog.style.marginTop=-(position.getHeight(dialog)/2)+"px";dialog.style.marginLeft=-(position.getWidth(dialog)/2)+"px";};setTimeout(function(){createDialog();var defTextLen=defaultInputText.length;if(input.selectionStart!==undefined){input.selectionStart=0;input.selectionEnd=defTextLen;}\u000aelse if(input.createTextRange){var range=input.createTextRange();range.collapse(false);range.moveStart("character",-defTextLen);range.moveEnd("character",defTextLen);range.select();}\u000ainput.focus();},0);};function UIManager(postfix,panels,undoManager,previewManager,commandManager,helpOptions,getString){var inputBox=panels.input,buttons={};makeSpritedButtonRow();var keyEvent="keydown";if(uaSniffed.isOpera){keyEvent="keypress";}\u000autil.addEvent(inputBox,keyEvent,function(key){if((key.ctrlKey||key.metaKey)&&!key.altKey&&!key.shiftKey){var keyCode=key.charCode||key.keyCode;var keyCodeStr=String.fromCharCode(keyCode).toLowerCase();switch(keyCodeStr){case"b":doClick(buttons.bold);break;case"i":doClick(buttons.italic);break;case"l":doClick(buttons.link);break;case"q":doClick(buttons.quote);break;case"k":doClick(buttons.code);break;case"g":doClick(buttons.image);break;case"o":doClick(buttons.olist);break;case"u":doClick(buttons.ulist);break;case"h":doClick(buttons.heading);break;case"r":doClick(buttons.hr);break;case"y":doClick(buttons.redo);break;case"z":if(key.shiftKey){doClick(buttons.redo);}\u000aelse{doClick(buttons.undo);}\u000abreak;default:return;}\u000aif(key.preventDefault){key.preventDefault();}\u000aif(window.event){window.event.returnValue=false;}}});util.addEvent(inputBox,"keyup",function(key){if(key.shiftKey&&!key.ctrlKey&&!key.metaKey){var keyCode=key.charCode||key.keyCode;if(keyCode===13){var fakeButton={};fakeButton.textOp=bindCommand("doAutoindent");doClick(fakeButton);}}});if(uaSniffed.isIE){util.addEvent(inputBox,"keydown",function(key){var code=key.keyCode;if(code===27){return false;}});}\u000afunction doClick(button){inputBox.focus();if(button.textOp){if(undoManager){undoManager.setCommandMode();}\u000avar state=new TextareaState(panels);if(!state){return;}\u000avar chunks=state.getChunks();var fixupInputArea=function(){inputBox.focus();if(chunks){state.setChunks(chunks);}\u000astate.restore();previewManager.refresh();};var noCleanup=button.textOp(chunks,fixupInputArea);if(!noCleanup){fixupInputArea();}}\u000aif(button.execute){button.execute(undoManager);}};function setupButton(button,isEnabled){var normalYShift="0px";var disabledYShift="-20px";var highlightYShift="-40px";var image=button.getElementsByTagName("span")[0];if(isEnabled){image.style.backgroundPosition=button.XShift+" "+normalYShift;button.onmouseover=function(){image.style.backgroundPosition=this.XShift+" "+highlightYShift;};button.onmouseout=function(){image.style.backgroundPosition=this.XShift+" "+normalYShift;};if(uaSniffed.isIE){button.onmousedown=function(){if(doc.activeElement&&doc.activeElement!==panels.input){return;}\u000apanels.ieCachedRange=document.selection.createRange();panels.ieCachedScrollTop=panels.input.scrollTop;};}\u000aif(!button.isHelp){button.onclick=function(){if(this.onmouseout){this.onmouseout();}\u000adoClick(this);return false;}}}\u000aelse{image.style.backgroundPosition=button.XShift+" "+disabledYShift;button.onmouseover=button.onmouseout=button.onclick=function(){};}}\u000afunction bindCommand(method){if(typeof method==="string")\u000amethod=commandManager[method];return function(){method.apply(commandManager,arguments);}}\u000afunction makeSpritedButtonRow(){var buttonBar=panels.buttonBar;var normalYShift="0px";var disabledYShift="-20px";var highlightYShift="-40px";var buttonRow=document.createElement("ul");buttonRow.id="wmd-button-row"+postfix;buttonRow.className='wmd-button-row';buttonRow=buttonBar.appendChild(buttonRow);var xPosition=0;var makeButton=function(id,title,XShift,textOp){var button=document.createElement("li");button.className="wmd-button";button.style.left=xPosition+"px";xPosition+=25;var buttonImage=document.createElement("span");button.id=id+postfix;button.appendChild(buttonImage);button.title=title;button.XShift=XShift;if(textOp)\u000abutton.textOp=textOp;setupButton(button,true);buttonRow.appendChild(button);return button;};var makeSpacer=function(num){var spacer=document.createElement("li");spacer.className="wmd-spacer wmd-spacer"+num;spacer.id="wmd-spacer"+num+postfix;buttonRow.appendChild(spacer);xPosition+=25;}\u000abuttons.bold=makeButton("wmd-bold-button",getString("bold"),"0px",bindCommand("doBold"));buttons.italic=makeButton("wmd-italic-button",getString("italic"),"-20px",bindCommand("doItalic"));makeSpacer(1);buttons.link=makeButton("wmd-link-button",getString("link"),"-40px",bindCommand(function(chunk,postProcessing){return this.doLinkOrImage(chunk,postProcessing,false);}));buttons.quote=makeButton("wmd-quote-button",getString("quote"),"-60px",bindCommand("doBlockquote"));buttons.code=makeButton("wmd-code-button",getString("code"),"-80px",bindCommand("doCode"));buttons.image=makeButton("wmd-image-button",getString("image"),"-100px",bindCommand(function(chunk,postProcessing){return this.doLinkOrImage(chunk,postProcessing,true);}));makeSpacer(2);buttons.olist=makeButton("wmd-olist-button",getString("olist"),"-120px",bindCommand(function(chunk,postProcessing){this.doList(chunk,postProcessing,true);}));buttons.ulist=makeButton("wmd-ulist-button",getString("ulist"),"-140px",bindCommand(function(chunk,postProcessing){this.doList(chunk,postProcessing,false);}));buttons.heading=makeButton("wmd-heading-button",getString("heading"),"-160px",bindCommand("doHeading"));buttons.hr=makeButton("wmd-hr-button",getString("hr"),"-180px",bindCommand("doHorizontalRule"));makeSpacer(3);buttons.undo=makeButton("wmd-undo-button",getString("undo"),"-200px",null);buttons.undo.execute=function(manager){if(manager)manager.undo();};var redoTitle=/win/.test(nav.platform.toLowerCase())?getString("redo"):getString("redomac");buttons.redo=makeButton("wmd-redo-button",redoTitle,"-220px",null);buttons.redo.execute=function(manager){if(manager)manager.redo();};if(helpOptions){var helpButton=document.createElement("li");var helpButtonImage=document.createElement("span");helpButton.appendChild(helpButtonImage);helpButton.className="wmd-button wmd-help-button";helpButton.id="wmd-help-button"+postfix;helpButton.XShift="-240px";helpButton.isHelp=true;helpButton.style.right="0px";helpButton.title=getString("help");helpButton.onclick=helpOptions.handler;setupButton(helpButton,true);buttonRow.appendChild(helpButton);buttons.help=helpButton;}\u000asetUndoRedoButtonStates();}\u000afunction setUndoRedoButtonStates(){if(undoManager){setupButton(buttons.undo,undoManager.canUndo());setupButton(buttons.redo,undoManager.canRedo());}};this.setUndoRedoButtonStates=setUndoRedoButtonStates;}\u000afunction CommandManager(pluginHooks,getString,converter){this.hooks=pluginHooks;this.getString=getString;this.converter=converter;}\u000avar commandProto=CommandManager.prototype;commandProto.prefixes="(?:\u005c\u005cs{4,}|\u005c\u005cs*>|\u005c\u005cs*-\u005c\u005cs+|\u005c\u005cs*\u005c\u005cd+\u005c\u005c.|=|\u005c\u005c+|-|_|\u005c\u005c*|#|\u005c\u005cs*\u005c\u005c[[^\u005cn]]+\u005c\u005c]:)";commandProto.unwrap=function(chunk){var txt=new re("([^\u005c\u005cn])\u005c\u005cn(?!(\u005c\u005cn|"+this.prefixes+"))","g");chunk.selection=chunk.selection.replace(txt,"$1 $2");};commandProto.wrap=function(chunk,len){this.unwrap(chunk);var regex=new re("(.{1,"+len+"})( +|$\u005c\u005cn?)","gm"),that=this;chunk.selection=chunk.selection.replace(regex,function(line,marked){if(new re("^"+that.prefixes,"").test(line)){return line;}\u000areturn marked+"\u005cn";});chunk.selection=chunk.selection.replace(/\u005cs+$/,"");};commandProto.doBold=function(chunk,postProcessing){return this.doBorI(chunk,postProcessing,2,this.getString("boldexample"));};commandProto.doItalic=function(chunk,postProcessing){return this.doBorI(chunk,postProcessing,1,this.getString("italicexample"));};commandProto.doBorI=function(chunk,postProcessing,nStars,insertText){chunk.trimWhitespace();chunk.selection=chunk.selection.replace(/\u005cn{2,}/g,"\u005cn");var starsBefore=/(\u005c**$)/.exec(chunk.before)[0];var starsAfter=/(^\u005c**)/.exec(chunk.after)[0];var prevStars=Math.min(starsBefore.length,starsAfter.length);if((prevStars>=nStars)&&(prevStars!=2||nStars!=1)){chunk.before=chunk.before.replace(re("[*]{"+nStars+"}$",""),"");chunk.after=chunk.after.replace(re("^[*]{"+nStars+"}",""),"");}\u000aelse if(!chunk.selection&&starsAfter){chunk.after=chunk.after.replace(/^([*_]*)/,"");chunk.before=chunk.before.replace(/(\u005cs?)$/,"");var whitespace=re.$1;chunk.before=chunk.before+starsAfter+whitespace;}\u000aelse{if(!chunk.selection&&!starsAfter){chunk.selection=insertText;}\u000avar markup=nStars<=1?"*":"**";chunk.before=chunk.before+markup;chunk.after=markup+chunk.after;}\u000areturn;};commandProto.stripLinkDefs=function(text,defsToAdd){text=text.replace(/^[ ]{0,3}\u005c[(\u005cd+)\u005c]:[ \u005ct]*\u005cn?[ \u005ct]*<?(\u005cS+?)>?[ \u005ct]*\u005cn?[ \u005ct]*(?:(\u005cn*)["(](.+?)[")][ \u005ct]*)?(?:\u005cn+|$)/gm,function(totalMatch,id,link,newlines,title){defsToAdd[id]=totalMatch.replace(/\u005cs*$/,"");if(newlines){defsToAdd[id]=totalMatch.replace(/["(](.+?)[")]$/,"");return newlines+title;}\u000areturn"";});return text;};commandProto.addLinkDef=function(chunk,linkDef){var refNumber=0;var defsToAdd={};chunk.before=this.stripLinkDefs(chunk.before,defsToAdd);chunk.selection=this.stripLinkDefs(chunk.selection,defsToAdd);chunk.after=this.stripLinkDefs(chunk.after,defsToAdd);var defs="";var regex=/(\u005c[)((?:\u005c[[^\u005c]]*\u005c]|[^\u005c[\u005c]])*)(\u005c][ ]?(?:\u005cn[ ]*)?\u005c[)(\u005cd+)(\u005c])/g;var complete=chunk.before+chunk.selection+chunk.after;var rendered=this.converter.makeHtml(complete);var testlink="http://this-is-a-real-link.biz/";while(rendered.indexOf(testlink)!=-1)\u000atestlink+="nicetry/";var fakedefs="\u005cn\u005cn";var skippedChars=0;var uniquified=complete.replace(regex,function uniquify(wholeMatch,before,inner,afterInner,id,end,offset){skippedChars+=offset;fakedefs+=" ["+skippedChars+"]: "+testlink+skippedChars+"/unicorn\u005cn";skippedChars+=before.length;inner=inner.replace(regex,uniquify);skippedChars-=before.length;var result=before+inner+afterInner+skippedChars+end;skippedChars-=offset;return result;});rendered=this.converter.makeHtml(uniquified+fakedefs);var okayToModify=function(offset){return rendered.indexOf(testlink+offset+"/unicorn")!==-1;}\u000avar addDefNumber=function(def){refNumber++;def=def.replace(/^[ ]{0,3}\u005c[(\u005cd+)\u005c]:/,"  ["+refNumber+"]:");defs+="\u005cn"+def;};var getLink=function(wholeMatch,before,inner,afterInner,id,end,offset){if(!okayToModify(skippedChars+offset))\u000areturn wholeMatch;skippedChars+=offset+before.length;inner=inner.replace(regex,getLink);skippedChars-=offset+before.length;if(defsToAdd[id]){addDefNumber(defsToAdd[id]);return before+inner+afterInner+refNumber+end;}\u000areturn wholeMatch;};var len=chunk.before.length;chunk.before=chunk.before.replace(regex,getLink);skippedChars+=len;len=chunk.selection.length;if(linkDef){addDefNumber(linkDef);}\u000aelse{chunk.selection=chunk.selection.replace(regex,getLink);}\u000askippedChars+=len;var refOut=refNumber;chunk.after=chunk.after.replace(regex,getLink);if(chunk.after){chunk.after=chunk.after.replace(/\u005cn*$/,"");}\u000aif(!chunk.after){chunk.selection=chunk.selection.replace(/\u005cn*$/,"");}\u000achunk.after+="\u005cn\u005cn"+defs;return refOut;};function properlyEncoded(linkdef){return linkdef.replace(/^\u005cs*(.*?)(?:\u005cs+"(.+)")?\u005cs*$/,function(wholematch,link,title){var inQueryString=false;link=link.replace(/%(?:[\u005cda-fA-F]{2})|\u005c?|\u005c+|[^\u005cw\u005cd-./[\u005c]]/g,function(match){if(match.length===3&&match.charAt(0)=="%"){return match.toUpperCase();}\u000aswitch(match){case"?":inQueryString=true;return"?";break;case"+":if(inQueryString)\u000areturn"%20";break;}\u000areturn encodeURI(match);})\u000aif(title){title=title.trim?title.trim():title.replace(/^\u005cs*/,"").replace(/\u005cs*$/,"");title=title.replace(/"/g,"quot;").replace(/\u005c(/g,"&#40;").replace(/\u005c)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;");}\u000areturn title?link+' "'+title+'"':link;});}\u000acommandProto.doLinkOrImage=function(chunk,postProcessing,isImage){chunk.trimWhitespace();chunk.findTags(/\u005cs*!?\u005c[/,/\u005c][ ]?(?:\u005cn[ ]*)?(\u005c[.*?\u005c])?/);var background;if(chunk.endTag.length>1&&chunk.startTag.length>0){chunk.startTag=chunk.startTag.replace(/!?\u005c[/,"");chunk.endTag="";this.addLinkDef(chunk,null);}\u000aelse{chunk.selection=chunk.startTag+chunk.selection+chunk.endTag;chunk.startTag=chunk.endTag="";if(/\u005cn\u005cn/.test(chunk.selection)){this.addLinkDef(chunk,null);return;}\u000avar that=this;var linkEnteredCallback=function(link){background.parentNode.removeChild(background);if(link!==null){chunk.selection=(" "+chunk.selection).replace(/([^\u005c\u005c](?:\u005c\u005c\u005c\u005c)*)(?=[[\u005c]])/g,"$1\u005c\u005c").substr(1);var linkDef=" [999]: "+properlyEncoded(link);var num=that.addLinkDef(chunk,linkDef);chunk.startTag=isImage?"![":"[";chunk.endTag="]["+num+"]";if(!chunk.selection){if(isImage){chunk.selection=that.getString("imagedescription");}\u000aelse{chunk.selection=that.getString("linkdescription");}}}\u000apostProcessing();};background=ui.createBackground();if(isImage){if(!this.hooks.insertImageDialog(linkEnteredCallback))\u000aui.prompt(this.getString("imagedialog"),imageDefaultText,linkEnteredCallback);}\u000aelse{ui.prompt(this.getString("linkdialog"),linkDefaultText,linkEnteredCallback);}\u000areturn true;}};commandProto.doAutoindent=function(chunk,postProcessing){var commandMgr=this,fakeSelection=false;chunk.before=chunk.before.replace(/(\u005cn|^)[ ]{0,3}([*+-]|\u005cd+[.])[ \u005ct]*\u005cn$/,"\u005cn\u005cn");chunk.before=chunk.before.replace(/(\u005cn|^)[ ]{0,3}>[ \u005ct]*\u005cn$/,"\u005cn\u005cn");chunk.before=chunk.before.replace(/(\u005cn|^)[ \u005ct]+\u005cn$/,"\u005cn\u005cn");if(!chunk.selection&&!/^[ \u005ct]*(?:\u005cn|$)/.test(chunk.after)){chunk.after=chunk.after.replace(/^[^\u005cn]*/,function(wholeMatch){chunk.selection=wholeMatch;return"";});fakeSelection=true;}\u000aif(/(\u005cn|^)[ ]{0,3}([*+-]|\u005cd+[.])[ \u005ct]+.*\u005cn$/.test(chunk.before)){if(commandMgr.doList){commandMgr.doList(chunk);}}\u000aif(/(\u005cn|^)[ ]{0,3}>[ \u005ct]+.*\u005cn$/.test(chunk.before)){if(commandMgr.doBlockquote){commandMgr.doBlockquote(chunk);}}\u000aif(/(\u005cn|^)(\u005ct|[ ]{4,}).*\u005cn$/.test(chunk.before)){if(commandMgr.doCode){commandMgr.doCode(chunk);}}\u000aif(fakeSelection){chunk.after=chunk.selection+chunk.after;chunk.selection="";}};commandProto.doBlockquote=function(chunk,postProcessing){chunk.selection=chunk.selection.replace(/^(\u005cn*)([^\u005cr]+?)(\u005cn*)$/,function(totalMatch,newlinesBefore,text,newlinesAfter){chunk.before+=newlinesBefore;chunk.after=newlinesAfter+chunk.after;return text;});chunk.before=chunk.before.replace(/(>[ \u005ct]*)$/,function(totalMatch,blankLine){chunk.selection=blankLine+chunk.selection;return"";});chunk.selection=chunk.selection.replace(/^(\u005cs|>)+$/,"");chunk.selection=chunk.selection||this.getString("quoteexample");var match="",leftOver="",line;if(chunk.before){var lines=chunk.before.replace(/\u005cn$/,"").split("\u005cn");var inChain=false;for(var i=0;i<lines.length;i++){var good=false;line=lines[i];inChain=inChain&&line.length>0;if(/^>/.test(line)){good=true;if(!inChain&&line.length>1)\u000ainChain=true;}else if(/^[ \u005ct]*$/.test(line)){good=true;}else{good=inChain;}\u000aif(good){match+=line+"\u005cn";}else{leftOver+=match+line;match="\u005cn";}}\u000aif(!/(^|\u005cn)>/.test(match)){leftOver+=match;match="";}}\u000achunk.startTag=match;chunk.before=leftOver;if(chunk.after){chunk.after=chunk.after.replace(/^\u005cn?/,"\u005cn");}\u000achunk.after=chunk.after.replace(/^(((\u005cn|^)(\u005cn[ \u005ct]*)*>(.+\u005cn)*.*)+(\u005cn[ \u005ct]*)*)/,function(totalMatch){chunk.endTag=totalMatch;return"";});var replaceBlanksInTags=function(useBracket){var replacement=useBracket?"> ":"";if(chunk.startTag){chunk.startTag=chunk.startTag.replace(/\u005cn((>|\u005cs)*)\u005cn$/,function(totalMatch,markdown){return"\u005cn"+markdown.replace(/^[ ]{0,3}>?[ \u005ct]*$/gm,replacement)+"\u005cn";});}\u000aif(chunk.endTag){chunk.endTag=chunk.endTag.replace(/^\u005cn((>|\u005cs)*)\u005cn/,function(totalMatch,markdown){return"\u005cn"+markdown.replace(/^[ ]{0,3}>?[ \u005ct]*$/gm,replacement)+"\u005cn";});}};if(/^(?![ ]{0,3}>)/m.test(chunk.selection)){this.wrap(chunk,SETTINGS.lineLength-2);chunk.selection=chunk.selection.replace(/^/gm,"> ");replaceBlanksInTags(true);chunk.skipLines();}else{chunk.selection=chunk.selection.replace(/^[ ]{0,3}> ?/gm,"");this.unwrap(chunk);replaceBlanksInTags(false);if(!/^(\u005cn|^)[ ]{0,3}>/.test(chunk.selection)&&chunk.startTag){chunk.startTag=chunk.startTag.replace(/\u005cn{0,2}$/,"\u005cn\u005cn");}\u000aif(!/(\u005cn|^)[ ]{0,3}>.*$/.test(chunk.selection)&&chunk.endTag){chunk.endTag=chunk.endTag.replace(/^\u005cn{0,2}/,"\u005cn\u005cn");}}\u000achunk.selection=this.hooks.postBlockquoteCreation(chunk.selection);if(!/\u005cn/.test(chunk.selection)){chunk.selection=chunk.selection.replace(/^(> *)/,function(wholeMatch,blanks){chunk.startTag+=blanks;return"";});}};commandProto.doCode=function(chunk,postProcessing){var hasTextBefore=/\u005cS[ ]*$/.test(chunk.before);var hasTextAfter=/^[ ]*\u005cS/.test(chunk.after);if((!hasTextAfter&&!hasTextBefore)||/\u005cn/.test(chunk.selection)){chunk.before=chunk.before.replace(/[ ]{4}$/,function(totalMatch){chunk.selection=totalMatch+chunk.selection;return"";});var nLinesBack=1;var nLinesForward=1;if(/(\u005cn|^)(\u005ct|[ ]{4,}).*\u005cn$/.test(chunk.before)){nLinesBack=0;}\u000aif(/^\u005cn(\u005ct|[ ]{4,})/.test(chunk.after)){nLinesForward=0;}\u000achunk.skipLines(nLinesBack,nLinesForward);if(!chunk.selection){chunk.startTag="    ";chunk.selection=this.getString("codeexample");}\u000aelse{if(/^[ ]{0,3}\u005cS/m.test(chunk.selection)){if(/\u005cn/.test(chunk.selection))\u000achunk.selection=chunk.selection.replace(/^/gm,"    ");else\u000achunk.before+="    ";}\u000aelse{chunk.selection=chunk.selection.replace(/^(?:[ ]{4}|[ ]{0,3}\u005ct)/gm,"");}}}\u000aelse{chunk.trimWhitespace();chunk.findTags(/`/,/`/);if(!chunk.startTag&&!chunk.endTag){chunk.startTag=chunk.endTag="`";if(!chunk.selection){chunk.selection=this.getString("codeexample");}}\u000aelse if(chunk.endTag&&!chunk.startTag){chunk.before+=chunk.endTag;chunk.endTag="";}\u000aelse{chunk.startTag=chunk.endTag="";}}};commandProto.doList=function(chunk,postProcessing,isNumberedList){var previousItemsRegex=/(\u005cn|^)(([ ]{0,3}([*+-]|\u005cd+[.])[ \u005ct]+.*)(\u005cn.+|\u005cn{2,}([*+-].*|\u005cd+[.])[ \u005ct]+.*|\u005cn{2,}[ \u005ct]+\u005cS.*)*)\u005cn*$/;var nextItemsRegex=/^\u005cn*(([ ]{0,3}([*+-]|\u005cd+[.])[ \u005ct]+.*)(\u005cn.+|\u005cn{2,}([*+-].*|\u005cd+[.])[ \u005ct]+.*|\u005cn{2,}[ \u005ct]+\u005cS.*)*)\u005cn*/;var bullet="-";var num=1;var getItemPrefix=function(){var prefix;if(isNumberedList){prefix=" "+num+". ";num++;}\u000aelse{prefix=" "+bullet+" ";}\u000areturn prefix;};var getPrefixedItem=function(itemText){if(isNumberedList===undefined){isNumberedList=/^\u005cs*\u005cd/.test(itemText);}\u000aitemText=itemText.replace(/^[ ]{0,3}([*+-]|\u005cd+[.])\u005cs/gm,function(_){return getItemPrefix();});return itemText;};chunk.findTags(/(\u005cn|^)*[ ]{0,3}([*+-]|\u005cd+[.])\u005cs+/,null);if(chunk.before&&!/\u005cn$/.test(chunk.before)&&!/^\u005cn/.test(chunk.startTag)){chunk.before+=chunk.startTag;chunk.startTag="";}\u000aif(chunk.startTag){var hasDigits=/\u005cd+[.]/.test(chunk.startTag);chunk.startTag="";chunk.selection=chunk.selection.replace(/\u005cn[ ]{4}/g,"\u005cn");this.unwrap(chunk);chunk.skipLines();if(hasDigits){chunk.after=chunk.after.replace(nextItemsRegex,getPrefixedItem);}\u000aif(isNumberedList==hasDigits){return;}}\u000avar nLinesUp=1;chunk.before=chunk.before.replace(previousItemsRegex,function(itemText){if(/^\u005cs*([*+-])/.test(itemText)){bullet=re.$1;}\u000anLinesUp=/[^\u005cn]\u005cn\u005cn[^\u005cn]/.test(itemText)?1:0;return getPrefixedItem(itemText);});if(!chunk.selection){chunk.selection=this.getString("litem");}\u000avar prefix=getItemPrefix();var nLinesDown=1;chunk.after=chunk.after.replace(nextItemsRegex,function(itemText){nLinesDown=/[^\u005cn]\u005cn\u005cn[^\u005cn]/.test(itemText)?1:0;return getPrefixedItem(itemText);});chunk.trimWhitespace(true);chunk.skipLines(nLinesUp,nLinesDown,true);chunk.startTag=prefix;var spaces=prefix.replace(/./g," ");this.wrap(chunk,SETTINGS.lineLength-spaces.length);chunk.selection=chunk.selection.replace(/\u005cn/g,"\u005cn"+spaces);};commandProto.doHeading=function(chunk,postProcessing){chunk.selection=chunk.selection.replace(/\u005cs+/g," ");chunk.selection=chunk.selection.replace(/(^\u005cs+|\u005cs+$)/g,"");if(!chunk.selection){chunk.startTag="## ";chunk.selection=this.getString("headingexample");chunk.endTag=" ##";return;}\u000avar headerLevel=0;chunk.findTags(/#+[ ]*/,/[ ]*#+/);if(/#+/.test(chunk.startTag)){headerLevel=re.lastMatch.length;}\u000achunk.startTag=chunk.endTag="";chunk.findTags(null,/\u005cs?(-+|=+)/);if(/=+/.test(chunk.endTag)){headerLevel=1;}\u000aif(/-+/.test(chunk.endTag)){headerLevel=2;}\u000achunk.startTag=chunk.endTag="";chunk.skipLines(1,1);var headerLevelToCreate=headerLevel==0?2:headerLevel-1;if(headerLevelToCreate>0){var headerChar=headerLevelToCreate>=2?"-":"=";var len=chunk.selection.length;if(len>SETTINGS.lineLength){len=SETTINGS.lineLength;}\u000achunk.endTag="\u005cn";while(len--){chunk.endTag+=headerChar;}}};commandProto.doHorizontalRule=function(chunk,postProcessing){chunk.startTag="----------\u005cn";chunk.selection="";chunk.skipLines(2,1,true);}})();(function(){var output,Converter;if(typeof exports==="object"&&typeof require==="function"){output=exports;Converter=require("./Markdown.Converter").Converter;}else{output=window.Markdown;Converter=output.Converter;}\u000aoutput.getSanitizingConverter=function(){var converter=new Converter();converter.hooks.chain("postConversion",sanitizeHtml);converter.hooks.chain("postConversion",balanceTags);return converter;}\u000afunction sanitizeHtml(html){return html.replace(/<[^>]*>?/gi,sanitizeTag);}\u000avar basic_tag_whitelist=/^(<\u005c/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol(?: start="\u005cd+")?|p|pre|s|sup|sub|strong|strike|ul)>|<(br|hr)\u005cs?\u005c/?>)$/i;var a_white=/^(<a\u005cshref="((https?|ftp):\u005c/\u005c/|\u005c/)[-A-Za-z0-9+&@#\u005c/%?=~_|!:,.;\u005c(\u005c)*[\u005c]$]+"(\u005cstitle="[^"<>]+")?\u005cs?>|<\u005c/a>)$/i;var img_white=/^(<img\u005cssrc="(https?:\u005c/\u005c/|\u005c/)[-A-Za-z0-9+&@#\u005c/%?=~_|!:,.;\u005c(\u005c)*[\u005c]$]+"(\u005cswidth="\u005cd{1,3}")?(\u005csheight="\u005cd{1,3}")?(\u005csalt="[^"<>]*")?(\u005cstitle="[^"<>]*")?\u005cs?\u005c/?>)$/i;function sanitizeTag(tag){if(tag.match(basic_tag_whitelist)||tag.match(a_white)||tag.match(img_white))\u000areturn tag;else\u000areturn"";}\u000afunction balanceTags(html){if(html=="")\u000areturn"";var re=/<\u005c/?\u005cw+[^>]*(\u005cs|$|>)/g;var tags=html.toLowerCase().match(re);var tagcount=(tags||[]).length;if(tagcount==0)\u000areturn html;var tagname,tag;var ignoredtags="<p><img><br><li><hr>";var match;var tagpaired=[];var tagremove=[];var needsRemoval=false;for(var ctag=0;ctag<tagcount;ctag++){tagname=tags[ctag].replace(/<\u005c/?(\u005cw+).*/,"$1");if(tagpaired[ctag]||ignoredtags.search("<"+tagname+">")>-1)\u000acontinue;tag=tags[ctag];match=-1;if(!/^<\u005c//.test(tag)){for(var ntag=ctag+1;ntag<tagcount;ntag++){if(!tagpaired[ntag]&&tags[ntag]=="</"+tagname+">"){match=ntag;break;}}}\u000aif(match==-1)\u000aneedsRemoval=tagremove[ctag]=true;else\u000atagpaired[match]=true;}\u000aif(!needsRemoval)\u000areturn html;var ctag=0;html=html.replace(re,function(match){var res=tagremove[ctag]?"":match;ctag++;return res;});return html;}})();
p1
.