(function(global){'use strict';global.setupCategoryDisplaySubcatList=function setupCategoryDisplaySubcatList(){var url=$('.category-list').data('subcat-info-url');if(url===undefined){return;}
$.ajax({url:url,dataType:'json',error:handleAjaxError,success:function(data){_.each(data.event_counts,function(count,id){var text=!count.value?$T.gettext('empty'):$T.ngettext('{0} event','{0} events',count.value).format(count.pretty);$('#category-event-count-'+id).text(text);});}});};global.setupCategoryDisplayEventList=function setupCategoryDisplayEventList(showPastEvents){var $eventList=$('.event-list');var $futureEvents=$eventList.find('.future-events');var $pastEvents=$eventList.find('.past-events');setupToggleEventListButton($futureEvents);setupToggleEventListButton($pastEvents,onTogglePastEvents);if(showPastEvents){$pastEvents.find('.js-toggle-list').first().trigger('click',true);}
function onTogglePastEvents(shown){$.ajax({url:$eventList.data('show-past-events-url'),method:shown?'PUT':'DELETE',error:handleAjaxError});}
function setupToggleEventListButton(wrapper,callback){var $wrapper=$(wrapper);var $content=$wrapper.find('.events');function updateMessage(visible){$wrapper.find('.js-hide-message').toggle(visible);$wrapper.find('.js-show-message').toggle(!visible);}
updateMessage(!$content.is(':empty'));function displaySpinner(visible){$wrapper.find('.js-toggle-list').toggle(!visible);$wrapper.find('.js-spinner').toggle(visible);}
displaySpinner(false);$wrapper.find('.js-toggle-list').on('click',function(evt,triggeredAutomatically){evt.preventDefault();var visible;if($content.is(':empty')){visible=true;displaySpinner(true);$.ajax({url:$content.data('event-list-url'),data:{before:$content.data('event-list-before'),after:$content.data('event-list-after')},error:handleAjaxError,success:function(data){$content.html(data.html);$content.show();updateMessage(true);displaySpinner(false);}});}else if($content.is(':visible')){visible=false;$content.hide();updateMessage(false);}else{visible=true;$content.show();updateMessage(true);}
if(!triggeredAutomatically&&callback){callback(visible);}});}};global.setupCategoryDisplay=function setupCategoryDisplay(){'use strict';$('.fav-button').on('click',function(){var $this=$(this);var isFavorite=$this.hasClass('enabled');$this.prop('disabled',true);$.ajax({url:$this.data('href'),method:isFavorite?'DELETE':'PUT',error:handleAjaxError,success:function(){$this.toggleClass('enabled',!isFavorite);},complete:function(){$this.prop('disabled',false);}});}).qtip({hide:{fixed:true,delay:500},content:{text:function(){var $this=$(this);if($this.hasClass('enabled')){return $T.gettext("Remove from your favourites");}else{return'<h3>{0}</h3><p>{1}</p>'.format($T.gettext("Add to your favourites"),$T.gettext('This will make events in this category visible on your <a href="{0}">Dashboard</a>.').format($this.data('favorites-href')));}}}});};})(window);(function(global){'use strict';global.setupCategoryCalendar=function setupCategoryCalendar(elementId,categoryURL){var cachedEvents={};$(elementId).fullCalendar({firstDay:1,height:800,eventOrder:'start',eventTextColor:'#FFF',timeFormat:'HH:mm',nextDayThreshold:'00:00',eventLimit:5,eventLimitClick:function(cellInfo){var content=$('<ul>');var events=cellInfo.segs.sort(function(a,b){var aTitle=a.event.title.toLowerCase();var bTitle=b.event.title.toLowerCase();if(aTitle<bTitle)return-1;if(aTitle>bTitle)return 1;return 0;});$.each(events,function(index,hiddenSegment){var li=$('<li>');var eventLink=$('<a>',{'href':hiddenSegment.event.url,'text':hiddenSegment.event.title});li.append(eventLink);content.append(li);});ajaxDialog({dialogClasses:'all-events-dialog',title:$T.gettext('Events happening on {0}'.format(cellInfo.date.format('MMMM Do YYYY'))),content:content});},buttonText:{'today':$T.gettext('Today')},events:function(start,end,timezone,callback){function updateCalendar(data){callback(data.events);var toolbarGroup=$(elementId).find('.fc-toolbar .fc-right');var ongoingEventsInfo=$('<a>',{'href':'#','class':'ongoing-events-info','text':$T.ngettext('{0} long-lasting event not shown','{0} long-lasting events not shown',data.ongoing_event_count).format(data.ongoing_event_count),'on':{'click':function(evt){evt.preventDefault();ajaxDialog({title:$T.gettext('Long lasting events'),content:$(data.ongoing_events_html),dialogClasses:'ongoing-events-dialog'});}}});toolbarGroup.find('.ongoing-events-info').remove();toolbarGroup.prepend(ongoingEventsInfo);}
var key='{0}-{1}'.format(start,end);if(cachedEvents[key]){updateCalendar(cachedEvents[key]);}else{$.ajax({url:categoryURL,data:{start:start.format('YYYY-MM-DD'),end:end.format('YYYY-MM-DD')},dataType:'json',contentType:'application/json',error:handleAjaxError,complete:IndicoUI.Dialogs.Util.progress(),success:function(data){updateCalendar(data);cachedEvents[key]=data;}});}}});};})(window);