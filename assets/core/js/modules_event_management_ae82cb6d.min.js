(function(global){'use strict';global.setupEventManagementActionMenu=function setupEventManagementActionMenu(){$('#event-action-move-to-category').on('click',function(evt){evt.preventDefault();var $this=$(this);$('<div>').categorynavigator({openInDialog:true,actionOn:{categoriesWithSubcategories:{disabled:true},categoriesWithoutEventCreationRights:{disabled:true},categories:{disabled:true,ids:[$this.data('category-id')]}},onAction:function(category){var msg=$T.gettext('You are about to move the event to the category "{0}". Are you sure you want to proceed?').format(category.title);confirmPrompt(msg,$T.gettext('Move event')).then(function(){$.ajax({url:$this.data('href'),type:'POST',data:{target_category_id:category.id},error:handleAjaxError,success:function(data){if(data.success){location.reload();}}});});}});});$('#event-action-menu-clones-target').qbubble({content:{text:$('#event-action-menu-clones')}});$('#event-action-menu-actions-target').qbubble({content:{text:$('#event-action-menu-actions')},style:{classes:'qtip-allow-overflow'}});var selectors=['#event-action-menu-actions button:not(.js-dropdown)','#event-action-menu-actions a:not(.disabled)'];$(selectors.join(', ')).on('click',function(){$('#event-action-menu-actions-target').qbubble('hide');});};function refreshPersonFilters(){var personRows=$('.js-event-person-list tr[data-person-roles]');var filters=$('.js-event-person-list [data-filter]:checked').map(function(){return $(this).data('filter');}).get();var visibleEntries=personRows.filter(function(){var $this=$(this);return _.any(filters,function(filterName){return $this.data('person-roles')[filterName];});});personRows.addClass('hidden');visibleEntries.removeClass('hidden');$('.js-event-person-list').trigger('indico:syncEnableIfChecked');}
global.setupEventPersonsList=function setupEventPersonsList(options){options=$.extend({hasNoAccountFilter:false},options);enableIfChecked('.js-event-person-list','.select-row:visible','.js-event-person-list .js-requires-selected-row');if($('.js-event-person-list').closest('.ui-dialog').length){$('.js-event-person-list [data-toggle=dropdown]').closest('.toolbar').dropdown();}
$('.js-event-person-list [data-filter]').on('click',refreshPersonFilters);$('.js-event-person-list td').on('mouseenter',function(){var $this=$(this);if(this.offsetWidth<this.scrollWidth&&!$this.attr('title')){$this.attr('title',$this.text());}});$('.js-event-person-list .tablesorter').tablesorter({cssAsc:'header-sort-asc',cssDesc:'header-sort-desc',headerTemplate:'',sortList:[[1,0]]});$('.js-event-person-list .js-count-label:not(.no-role)').qbubble({show:{event:'mouseover'},hide:{fixed:true,delay:100,event:'mouseleave'},position:{my:'left center',at:'right center'},content:{text:function(){var html=$('<ul class="qbubble-item-list">');var items=_.values($(this).data('items')).sort(function(a,b){return strnatcmp(a.title.toLowerCase(),b.title.toLowerCase());});$.each(items,function(){var item=$('<li>');if(this.url){item.append($('<a>',{text:this.title,href:this.url}));}else{item.text(this.title);}
html.append(item);});return html;}}});if(options.hasNoAccountFilter){$('.js-event-person-list [data-filter]:not(#filter-no-account)').on('change',function(){$('#filter-no-account').prop('checked',false);refreshPersonFilters();});$('#filter-no-account').on('change',function(){if(this.checked){$('.js-event-person-list [data-filter]:checked:not(#filter-no-account)').prop('checked',false);}
refreshPersonFilters();});}};global.showUndoWarning=function showUndoWarning(message,feedbackMessage,actionCallback){cornerMessage({message:message,progressMessage:$T.gettext("Undoing previous operation..."),feedbackMessage:feedbackMessage,actionLabel:$T.gettext('Undo'),actionCallback:actionCallback,duration:10000,feedbackDuration:4000,class:'warning'});};global.handleRowSelection=function handleRowSelection(){$('table.i-table input.select-row').on('change',function(){$(this).closest('tr').toggleClass('selected',this.checked);}).trigger('change');};global.showThemeSettingsForm=function showThemeSettingsForm(options){options=$.extend(true,{formUrl:null,themeFieldId:null,lastFieldId:null},options);$('#'+options.themeFieldId).on('change',function(){$.ajax({url:options.formUrl,data:{theme:$(this).val()},complete:IndicoUI.Dialogs.Util.progress(),error:handleAjaxError,success:function(data){var lastField=$('#'+options.lastFieldId);lastField.nextAll(':not(.form-group-footer)').remove();if(data.html){lastField.after(data.html);}
if(data.js){$('body').append(data.js);}}});});};})(window);(function(global){'use strict';global.setupBadgePrinting=function setupBadgePrinting(templates){var $template=$('#template');var $pageLayout=$('#page_layout');var $dashedBorder=$('#dashed_border');var $pageSize=$('#page_size');var $pageOrientation=$('#page_orientation');var $marginEditor=$('.margin-editor');var $infoMessage=$('.info');function toggleFoldableOption(template,pageSize,pageOrientation){var foldablePairs={A0:'A2',A1:'A3',A2:'A4',A3:'A5',A4:'A6',A5:'A7',A6:'A8'};if(foldablePairs[pageSize]===template.format&&pageOrientation===template.orientation){$("#page_layout option[value='foldable']").prop('disabled',false);}else{$("#page_layout option[value='foldable']").prop('disabled',true);if($('#page_layout :selected').val()==='foldable'){$('#page_layout :selected').next().prop('selected',true);}}}
$template.on('change',function(){var $this=$(this);var template=templates[parseInt($this.val(),10)];$pageLayout.closest('.form-group').toggle(!!template.backside_tpl_id);$pageLayout.val('front_only');toggleFoldableOption(template,$pageSize.val(),$pageOrientation.val());}).change();$pageLayout.on('change',function(){$marginEditor.add($infoMessage).toggle($(this).val()!=='foldable');$dashedBorder.closest('.form-group').toggle($(this).val()!=='foldable');}).change();$pageSize.add($pageOrientation).on('change',function(){toggleFoldableOption(templates[parseInt($template.val(),10)],$pageSize.val(),$pageOrientation.val());$pageLayout.change();}).change();};})(window);(function(global){'use strict';function colorizeFilter(filter){var dropdown=filter.find('.dropdown');filter.toggleClass('active highlight',dropdown.find(':checked').length>0);}
function colorizeActiveFilters(){$('.list-filter .filter').each(function(){colorizeFilter($(this));});}
function setupStaticURLGeneration(){$('.js-static-url').on('click',function(){var $this=$(this);$.ajax({method:'POST',url:$this.data('href'),error:handleAjaxError,complete:IndicoUI.Dialogs.Util.progress(),success:function(data){$this.copyURLTooltip(data.url);}});});}
global.handleRowSelection=function(){$('table.i-table input.select-row').on('change',function(){$(this).closest('tr').toggleClass('selected',this.checked);$('.js-requires-selected-row').toggleClass('disabled',!$('.list input:checkbox:checked').length);}).trigger('change');};global.setupTableSorter=function(){$('.list .tablesorter').tablesorter({cssAsc:'header-sort-asc',cssDesc:'header-sort-desc',headerTemplate:'',headers:{0:{sorter:false}}});};global.setupListFilter=function(){var visibleItems=$('#visible-items');var hasColumnSelector=!!$('#visible-items').length;$('.list-filter .filter').each(function(){var $filter=$(this).parent();var isOnlyFilter=!!$filter.find('[data-only-filter]').length;$filter.dropdown({selector:"a[data-toggle='dropdown']",relative_to:$filter});if(!hasColumnSelector||isOnlyFilter){$filter.find('.title-wrapper').on('click',function(evt){$filter.find("a[data-toggle='dropdown']").trigger('click');evt.stopPropagation();});}});colorizeActiveFilters();$('.list-filter-dialog .toolbar').dropdown();$('.title-wrapper').on('click',function(evt){if($(evt.target).hasClass('filter')){return;}
var $this=$(this);var field=$this.closest('.title-wrapper');var fieldId=field.data('id');var visibilityIcon=field.find('.visibility');var enabled=visibilityIcon.hasClass('enabled');var isOnlyFilter=!!$this.parent().find('[data-only-filter]').length;if(hasColumnSelector&&!isOnlyFilter){var itemsData=JSON.parse(visibleItems.val());if(enabled){itemsData.splice(itemsData.indexOf(fieldId),1);}else{itemsData.push(fieldId);}
visibilityIcon.toggleClass('enabled',!enabled);field.toggleClass('striped',enabled);visibleItems.val(JSON.stringify(itemsData)).trigger('change');}});if(hasColumnSelector){$('.title-wrapper').each(function(){var field=$(this);var fieldId=field.data('id');var itemsData=JSON.parse(visibleItems.val());var isOnlyFilter=!!field.parent().find('[data-only-filter]').length;if(!isOnlyFilter){if(itemsData.indexOf(fieldId)!==-1){field.find('.visibility').addClass('enabled');}else{field.addClass('striped');}}});}
$('.js-reset-btn').on('click',function(){$('.list-filter input:checkbox:checked').prop('checked',false).trigger('change');$('.js-clear-filters-message').show({done:function(){var $this=$(this);setTimeout(function(){$this.slideUp();},4000);}});});$('.list-filter input:checkbox').on('change',function(){colorizeFilter($(this).closest('.filter'));});$('.list-filter .title').on('mouseover',function(){var title=$(this);if(this.offsetWidth<this.scrollWidth){title.qtip({hide:'mouseout',content:title.text(),overwrite:false}).qtip('show');}});$('#list-filter-select-all').on('click',function(){$('.list-filter-dialog .visibility:not(.enabled)').trigger('click');});$('#list-filter-select-none').on('click',function(){$('.list-filter-dialog .visibility.enabled').trigger('click');});};global.setupListGenerator=function(filterConfig){var applySearchFilters;if(filterConfig){applySearchFilters=setupSearchBox(filterConfig);}
setupStaticURLGeneration();handleRowSelection();setupTableSorter();$('.list').on('indico:htmlUpdated',function(){handleRowSelection();setupTableSorter();});$('.list .toolbar').dropdown();$('#select-all').on('click',function(){$('table.i-table input.select-row').prop('checked',true).trigger('change');});$('#select-none').on('click',function(){$('table.i-table input.select-row').prop('checked',false).trigger('change');});$('.change-columns-width').on('click',function(){$('.js-list-table-wrapper').toggleClass('scrollable');$('.change-columns-width').toggleClass('active');});$('.js-submit-list-form').on('click',function(e){e.preventDefault();var $this=$(this);if(!$this.hasClass('disabled')){$('.list form').attr('action',$this.data('href')).submit();}});$('.list .toolbar').on('click','.disabled',function(e){e.preventDefault();e.stopPropagation();});return applySearchFilters;};global.getSelectedRows=function(){return $('.list input:checkbox:checked').map(function(){return $(this).val();}).get();};})(window);(function(global){'use strict';var totalDurationDisplay;function formatState(visible,total){return'{0} / {1}'.format('<strong>{0}</strong>'.format(visible.length),total.length);}
function setState(state,visible,total){state.html($('<span>').append(formatState(visible,total)));state.attr('title',$T.gettext("{0} out of {1} displayed").format(visible.length,total.length));if(!totalDurationDisplay){totalDurationDisplay=$('#total-duration').detach();}}
function _applySearchFilters(searchBoxConfig){var $items=$(searchBoxConfig.listItems);var term=$(searchBoxConfig.term).val().trim();var $state=$(searchBoxConfig.state);var $visibleEntries,m;var $filterPlaceholder=$(searchBoxConfig.placeholder);$filterPlaceholder.hide();$state.removeClass('active');if(!term){$items.show();setState($state,$items,$items);if(totalDurationDisplay){$state.after(totalDurationDisplay);totalDurationDisplay=null;}
return;}
if((m=term.match(/^#(\d+)$/))){$visibleEntries=$items.filter('[data-friendly-id="'+m[1]+'"]');}else{$visibleEntries=$items.find('[data-searchable*="'+term.toLowerCase()+'"]').closest(searchBoxConfig.itemHandle);}
if($visibleEntries.length===0){$filterPlaceholder.text($T.gettext('There are no entries that match your search criteria.')).show();$state.addClass('active');}else if($visibleEntries.length!==$items.length){$state.addClass('active');}
setState($state,$visibleEntries,$items);$items.hide();$visibleEntries.show();$(window).trigger('scroll');}
global.setupSearchBox=function setupSearchBox(config){var applySearchFilters=_.partial(_applySearchFilters,config);$(config.term).realtimefilter({callback:applySearchFilters});applySearchFilters();return applySearchFilters;};})(window);