type("RoomListWidget",["ListWidget"],{_drawItem:function(room){var self=this;var roomData=room.get();var removeButton=Widget.link(command(function(){self.removeProcess(room.key,function(result){if(result){self.set(room,null);}});},IndicoUI.Buttons.removeButton()));return Html.div({style:{display:'inline'}},Html.span({},Html.div({style:{cssFloat:"right",paddingRight:"10px"}},removeButton),$B(Html.span(),self.useValue?roomData:room.key)));}},function(style,removeProcess,useValue){this.removeProcess=removeProcess;this.useValue=useValue||false;if(!exists(style)){style="user-list";}
this.ListWidget(style);});function aspectListNothing(data,func){each(data,function(){func(true);});}
function singleAspectNothing(user,func){func(true);}
type("MapAspectDataPopup",["ExclusivePopupWithButtons"],{param:function(aspectData,label,propertyName){var edit=Html.edit({style:{width:'300px'}});var accessor=aspectData.accessor(propertyName);this.parameterManager.add(edit,'text',false);var binding=$B(edit,accessor);return[$T(label),binding];},draw:function(){var aspectData=this.aspectData;var self=this;self.parameterManager=new IndicoUtil.parameterManager();var form=IndicoUtil.createFormFromMap([this.param(aspectData,'Name','name'),this.param(aspectData,'Center latitude','center_latitude'),this.param(aspectData,'Center longitude','center_longitude'),this.param(aspectData,'Top-left latitude','top_left_latitude'),this.param(aspectData,'Top-left longitude','top_left_longitude'),this.param(aspectData,'Bottom-right latitude','bottom_right_latitude'),this.param(aspectData,'Bottom-right longitude','bottom_right_longitude'),this.param(aspectData,'Zoom level','zoom_level'),[$T('Default on start-up'),$B(Html.checkbox({}),aspectData.accessor('default_on_startup'))]]);return this.ExclusivePopupWithButtons.prototype.draw.call(this,form);},_getButtons:function(){var self=this;return[[$T('Save'),function(){self.action(self.aspectData,function(){self.close();});}],[$T('Cancel'),function(){self.close();}]];}},function(title,aspectData,action){this.aspectData=aspectData;this.action=action;this.ExclusivePopupWithButtons(title);});type("MapAspectListWidget",["ListWidget"],{_drawItem:function(aspect){var self=this;var aspectData=aspect.get();var editButton=Widget.link(command(function(){var editPopup=new MapAspectDataPopup('Change map aspect data',aspectData.clone(),function(newData,suicideHook){if(editPopup.parameterManager.check()){self.editProcess(aspectData,function(result){if(result){if(!exists(newData.get('default_on_startup'))){newData.set('default_on_startup',false);}
aspectData.update(newData.getAll());}},newData);suicideHook();}});editPopup.open();},IndicoUI.Buttons.editButton()));var removeButton=Widget.link(command(function(){self.removeProcess(aspectData,function(result){if(result){self.set(aspect.key,null);}});},IndicoUI.Buttons.removeButton()));var buttonDiv=Html.div({style:{cssFloat:'right',paddingRight:pixels(10)}});buttonDiv.append(editButton);buttonDiv.append(removeButton);var b1=$B(Html.span(),aspectData.accessor('name'));var b2=$B(Html.span(),aspectData.accessor('default_on_startup'),function(x){return x?' ('+$T('Default')+')':''});var aspectName=Html.span({},b1,b2);return Html.span({},buttonDiv,aspectName);}},function(style,editProcess,removeProcess){this.style=any(style,"UIAspectsList");this.editProcess=any(editProcess,singleAspectNothing);this.removeProcess=any(removeProcess,singleAspectNothing);this.ListWidget(style);});type("MapAspectListField",["IWidget"],{clear:function(){this.aspectList.clearList();},draw:function(){var self=this;var buttonDiv=Html.div({style:{marginTop:pixels(10)}});var addNewAspectButton=Html.input("button",{style:{marginRight:pixels(5)},className:'i-button'},$T('Add Map Aspect'));addNewAspectButton.observeClick(function(){var newAspect=$O({});var newAspectPopup=new MapAspectDataPopup($T('New map aspect'),newAspect,function(newData,suicideHook){if(newAspectPopup.parameterManager.check()){newAspect.update(newData.getAll());if(!exists(newAspect.get('default_on_startup'))){newAspect.set('default_on_startup',false);}
self.newProcess(newAspect,function(result){if(result.ok){newAspect.set('id',result.id)
self.aspectList.set(result.id,newAspect);}});suicideHook();}});newAspectPopup.open();});buttonDiv.append(addNewAspectButton);return Widget.block([Html.div(this.aspectDivStyle,this.aspectList.draw()),buttonDiv]);}},function(aspectDivStyle,aspectListStyle,initialAspects,newProcess,editProcess,removeProcess){var self=this;this.aspectList=new MapAspectListWidget(aspectListStyle,editProcess,removeProcess);this.aspectDivStyle=any(aspectDivStyle,"UIAspectsListDiv");if(exists(initialAspects)){each(initialAspects,function(aspect){self.aspectList.set(aspect.id,$O(aspect));});}
this.newProcess=any(newProcess,aspectListNothing);});